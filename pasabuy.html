<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DalağŸš²Na - PasaBuy Order</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0; padding: 1rem;
      background: #ffffff;
      max-width: 480px;
      margin: auto;
    }
    h2 { text-align: center; }
    form { display: flex; flex-direction: column; gap: 1rem; }
    input, textarea, select {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
    }
    label { font-weight: bold; }
    .hidden { display: none; }
    .notice {
      background: #f0f8ff;
      padding: 0.8rem;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .btn {
      background: #00b894;
      color: white;
      border: none;
      padding: 0.8rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
      transition: 0.2s ease;
    }
    .btn:hover {
      background: #019875;
    }
  </style>
</head>
<body>

<h2>ğŸ›’ PasaBuy Order (Handumanan)</h2>

<form id="pasabuyForm" enctype="multipart/form-data">

  <label>Customer Name</label>
  <input type="text" name="name" required />

  <label>Phone Number</label>
  <input type="tel" name="phone" required />

  <label>Exact Address</label>
  <input type="text" name="address" required />

  <label>Exact Location Name (Auto)</label>
  <input type="text" id="exactLocation" name="locationName" required placeholder="Tap to auto-detect" />

  <label>List of Items</label>
  <textarea name="items" required placeholder="e.g. 1kg rice, 2 cans tuna..."></textarea>

  <label>Total Budget (â‚±)</label>
  <input type="number" id="budget" name="budget" required min="1" />

  <label>Quantity of Items</label>
  <input type="number" name="quantity" required min="1" />

  <label>Delivery Option</label>
  <label><input type="radio" name="deliveryType" value="today" checked> Deliver Today (within 1 hour)</label>
  <label><input type="radio" name="deliveryType" value="later"> Deliver Later</label>

  <div id="laterSchedule" class="hidden">
    <label>Choose Date</label>
    <input type="date" id="laterDate" name="laterDate" />
    <label>Choose Time</label>
    <input type="time" id="laterTime" name="laterTime" />
  </div>

  <label>Proof of Deposit (Image)</label>
  <input type="file" name="depositProof" accept="image/*" required />

  <label>50% Downpayment (Auto)</label>
  <input type="text" id="downpayment" readonly />

  <div class="notice">
    Please deposit 50% of your budget to:<br />
    <strong>GCash: 0917-XXXXXXX</strong><br/>
    Send proof above.
  </div>

  <button type="submit" class="btn">Submit Order</button>
</form>

<script>
  // Toggle delivery schedule
  document.querySelectorAll('[name="deliveryType"]').forEach(el => {
    el.addEventListener('change', () => {
      const later = document.querySelector('[name="deliveryType"]:checked').value === "later";
      document.getElementById("laterSchedule").classList.toggle("hidden", !later);
    });
  });

  // Autofill exact location
  window.addEventListener("load", () => {
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
        const data = await res.json();
        document.getElementById("exactLocation").value = data.display_name || '';
      });
    }
  });

  // Auto-calculate downpayment
  document.getElementById("budget").addEventListener("input", (e) => {
    const budget = parseFloat(e.target.value);
    const down = budget * 0.5 + 29.99 + 10.01; // budget x 50% + service + delivery
    document.getElementById("downpayment").value = "â‚±" + down.toFixed(2);
  });

  // WhatsApp & Airtable Integration
  document.getElementById("pasabuyForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target;
    const name = form.name.value;
    const phone = form.phone.value;
    const address = form.address.value;
    const locationName = form.locationName.value;
    const items = form.items.value;
    const budget = form.budget.value;
    const quantity = form.quantity.value;
    const delivery = form.deliveryType.value === 'today' ? 'Today (within 1hr)' : `${form.laterDate.value} at ${form.laterTime.value}`;
    const downpayment = document.getElementById("downpayment").value;

    // WhatsApp Message Summary
    const message = `ğŸ›’ *PasaBuy Order*\n\nğŸ‘¤ Name: ${name}\nğŸ“ Phone: ${phone}\nğŸ¡ Address: ${address}\nğŸ“ Location: ${locationName}\nğŸ“¦ Items: ${items}\nğŸ“Š Qty: ${quantity}\nğŸ’° Budget: â‚±${budget}\nğŸ“… Delivery: ${delivery}\nğŸ’¸ Downpayment: ${downpayment}`;

    // Send to WhatsApp (Admin/Rider)
    const encodedMsg = encodeURIComponent(message);
    const whatsappURL = `https://wa.me/63XXXXXXXXXX?text=${encodedMsg}`;
    window.open(whatsappURL, "_blank");

    // Optional: Send to Airtable
    // Use fetch() with FormData or make webhook call here
    alert("Order submitted! Please wait for confirmation.");
    form.reset();
    document.getElementById("downpayment").value = "";
    document.getElementById("laterSchedule").classList.add("hidden");
  });
</script>

</body>
</html>
