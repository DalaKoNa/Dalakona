<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PasaBuy Custom Order</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 500px;
      margin: 2rem auto;
      background: white;
      padding: 1.5rem;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      color: #0057b8;
      font-size: 1.3rem;
    }
    label {
      font-weight: 600;
      display: block;
      margin: 0.8rem 0 0.3rem;
    }
    input, textarea, select {
      width: 100%;
      padding: 0.65rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .item-group {
      padding: 1rem;
      margin-bottom: 1rem;
      background: #f1f1f1;
      border-radius: 10px;
      position: relative;
    }
    .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 14px;
      cursor: pointer;
    }
    .preview {
      max-width: 100%;
      max-height: 120px;
      margin-top: 0.3rem;
      display: none;
      border-radius: 8px;
    }
    button {
      margin-top: 1rem;
      padding: 0.8rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .add-item-btn {
      background: #0057b8;
      color: white;
      width: 100%;
    }
    .submit-btn {
      background: green;
      color: white;
      width: 100%;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>üõí PasaBuy ‚Äì Custom Items</h2>
  
  <div id="items-container"></div>
  <button class="add-item-btn" onclick="addItem()">‚ûï Add Item</button>

  <label>üë§ Your Name:</label>
  <input type="text" id="cust-name" required>

  <label>üìû Phone Number:</label>
  <input type="text" id="cust-phone" required>

  <label>üìç Delivery Address:</label>
  <input type="text" id="cust-address" required>

  <label>üí≥ Payment Method:</label>
  <select id="cust-payment">
    <option value="Cash on Delivery">Cash on Delivery</option>
    <option value="GCash">GCash</option>
    <option value="PayMaya">PayMaya</option>
  </select>

  <button class="submit-btn" onclick="submitOrder()">‚úÖ Send to WhatsApp</button>
</div>
<script>
let itemIndex = 0;

function addItem() {
  const container = document.getElementById("items-container");

  const div = document.createElement("div");
  div.className = "item-group";
  div.setAttribute("data-index", itemIndex);

  div.innerHTML = `
    <button class="remove-btn" onclick="removeItem(${itemIndex})">‚úï</button>
    <label>Item Name:</label>
    <input type="text" id="item-name-${itemIndex}" required />

    <label>Quantity:</label>
    <input type="number" id="item-qty-${itemIndex}" min="1" value="1" required />

    <label>üîó Product Link (optional):</label>
    <input type="url" id="item-link-${itemIndex}" placeholder="https://..." />

    <label>üì∑ Upload Image (optional):</label>
    <input type="file" id="item-photo-${itemIndex}" accept="image/*" onchange="previewImage(event, ${itemIndex})" />
    <img id="preview-${itemIndex}" class="preview" />
  `;

  container.appendChild(div);
  itemIndex++;
}

function removeItem(index) {
  const group = document.querySelector(`.item-group[data-index="${index}"]`);
  if (group) group.remove();
}

function previewImage(event, index) {
  const file = event.target.files[0];
  const preview = document.getElementById(`preview-${index}`);
  if (file) {
    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
      preview.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
}

function submitOrder() {
  const name = document.getElementById("cust-name").value.trim();
  const phone = document.getElementById("cust-phone").value.trim();
  const address = document.getElementById("cust-address").value.trim();
  const payment = document.getElementById("cust-payment").value;

  if (!name || !phone || !address) {
    alert("Please complete all required fields.");
    return;
  }

  const deliveryFee = 29.99;
  const serviceFee = 10.01;
  const payStatus = payment === "Cash on Delivery" ? "Unpaid - COD" : `Paid via ${payment}`;

  // Build item list
  const items = [];
  for (let i = 0; i < itemIndex; i++) {
    const nameEl = document.getElementById(`item-name-${i}`);
    const qtyEl = document.getElementById(`item-qty-${i}`);
    const linkEl = document.getElementById(`item-link-${i}`);
    const photoEl = document.getElementById(`preview-${i}`);

    if (nameEl && qtyEl) {
      let entry = `‚Ä¢ ${nameEl.value.trim()} x${qtyEl.value.trim()}`;
      if (linkEl && linkEl.value.trim()) entry += `\n   üîó ${linkEl.value.trim()}`;
      if (photoEl && photoEl.src && photoEl.style.display !== "none") entry += `\n   üì∑ Photo attached.`;
      items.push(entry);
    }
  }

  if (items.length === 0) {
    alert("Please add at least one item.");
    return;
  }

  const now = new Date();
  const date = now.toISOString().split("T")[0];
  const time = new Date(now.getTime() + 60 * 60 * 1000).toTimeString().slice(0, 5);
  const locationUrl = "https://maps.google.com"; // You can extend this with geolocation if needed

  const message = `*PasaBuy Order ‚Äì DalaKoNa*\n\nüìù *Items to Buy:*\n${items.join("\n\n")}\n\nüìç *Address:* ${address}\nüóì *Date:* ${date}\nüïí *Time:* ${time}\nüë§ *Name:* ${name}\nüìû *Phone:* ${phone}\nüí∏ *Payment:* ${payStatus}\n\nüí∞ *Delivery Fee:* ‚Ç±${deliveryFee.toFixed(2)}\n‚öôÔ∏è *Service Fee:* ‚Ç±${serviceFee.toFixed(2)}\n*Total Add-on Estimate:* ‚Ç±${(deliveryFee + serviceFee).toFixed(2)}\n\nüöÄ From: dalako-na.web.app`;

  const encoded = encodeURIComponent(message);
  const phoneNumber = "63XXXXXXXXXX"; // Replace with your WhatsApp number

  window.open(`https://wa.me/${phoneNumber}?text=${encoded}`, "_blank");

  setTimeout(() => {
    window.location.href = "thank-you.html";
  }, 3000);
}

// Initialize with one item by default
addItem();
</script>
</body>
</html>
