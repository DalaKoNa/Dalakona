<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PasaBuy Order â€“ DalaðŸš²Na</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f8f9fa;
    }
    .container {
      max-width: 480px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .item-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      align-items: center;
    }
    .item-group input[type="text"],
    .item-group input[type="number"] {
      flex: 1;
    }
    .item-group button {
      background: #ff4d4d;
      border: none;
      padding: 8px;
      border-radius: 6px;
      font-size: 1rem;
      color: #fff;
      cursor: pointer;
    }
    #add-item-btn {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 16px;
    }
    #add-item-btn:hover {
      background: #0056b3;
    }
    #cart-summary {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 0.95rem;
    }
    .submit-btn {
      background: green;
      color: #fff;
      padding: 12px;
      width: 100%;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    .submit-btn:disabled {
      background: #999;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ›’ PasaBuy Request</h2>

    <label>Customer Name *</label>
    <input type="text" id="customerName" required>

    <label>Phone Number *</label>
    <input type="text" id="customerPhone" required>

    <label>Store *</label>
    <select id="storeSelect">
      <option value="">Select a store</option>
      <option value="Handumanan Hypermarket">Handumanan Hypermarket</option>
      <option value="Watsons">Watsons</option>
      <option value="Generika">Generika</option>
      <option value="Mr. DIY">Mr. DIY</option>
    </select>

    <label>Items to Buy *</label>
    <div id="items-container"></div>
    <button type="button" id="add-item-btn" onclick="addItem()">âž• Add Item</button>

    <label>Delivery Type *</label>
    <select id="deliveryType" onchange="handleDeliveryType(this.value)">
      <option value="Today">Today</option>
      <option value="Later">Later</option>
    </select>

    <label>Delivery Date *</label>
    <input type="date" id="deliveryDate">

    <label>Delivery Time *</label>
    <input type="time" id="deliveryTime">

    <div id="cart-summary">
      <strong>Cart Summary:</strong><br>
      <span id="summary-details">No items yet.</span><br><br>
      <strong>Delivery Fee:</strong> â‚±29.99<br>
      <strong>Service Fee:</strong> â‚±10.01<br>
      <strong>Total:</strong> <span id="total-amount">â‚±0.00</span>
    </div>

    <button class="submit-btn" id="submitBtn" onclick="submitOrder()" disabled>ðŸ“² Submit via WhatsApp</button>
  </div>

  <script>
    function addItem(name = '', qty = '') {
      const container = document.getElementById('items-container');
      const itemGroup = document.createElement('div');
      itemGroup.className = 'item-group';
      itemGroup.innerHTML = `
        <input type="text" name="itemName[]" placeholder="Item name" value="${name}" required />
        <input type="number" name="itemQty[]" placeholder="Qty" value="${qty}" min="1" required />
        <button type="button" onclick="this.parentElement.remove(); updateCartSummary();">ðŸ—‘</button>
      `;
      container.appendChild(itemGroup);
      updateCartSummary();
    }

    function handleDeliveryType(type) {
      const dateInput = document.getElementById('deliveryDate');
      const timeInput = document.getElementById('deliveryTime');
      const today = new Date().toISOString().split('T')[0];
      const now = new Date(new Date().getTime() + 60 * 60 * 1000).toISOString().slice(11, 16);

      if (type === "Today") {
        dateInput.value = today;
        dateInput.readOnly = true;
        timeInput.value = now;
        timeInput.readOnly = true;
      } else {
        dateInput.readOnly = false;
        timeInput.readOnly = false;
      }
    }

    function updateCartSummary() {
      const items = document.querySelectorAll('#items-container .item-group');
      let summary = '';
      let total = 0;

      items.forEach(group => {
        const name = group.querySelector('input[type="text"]').value.trim();
        const qty = parseInt(group.querySelector('input[type="number"]').value);
        if (name && qty > 0) {
          summary += `â€¢ ${name} x${qty}<br>`;
          total += qty * 50; // assume â‚±50 per item
        }
      });

      total += 29.99 + 10.01; // delivery fee + service fee

      document.getElementById('summary-details').innerHTML = summary || 'No items yet.';
      document.getElementById('total-amount').innerText = `â‚±${total.toFixed(2)}`;
      validateForm();
    }

    function validateForm() {
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const store = document.getElementById('storeSelect').value;
      const items = document.querySelectorAll('#items-container .item-group');

      const valid = name && phone && store && items.length > 0;
      document.getElementById('submitBtn').disabled = !valid;
    }

    function submitOrder() {
      const confirmationNumber = 'PB' + Date.now().toString().slice(-6);
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const store = document.getElementById('storeSelect').value;
      const deliveryType = document.getElementById('deliveryType').value;
      const deliveryDate = document.getElementById('deliveryDate').value;
      const deliveryTime = document.getElementById('deliveryTime').value;
      const summary = document.getElementById('summary-details').innerHTML.replace(/<br>/g, '\n');
      const total = document.getElementById('total-amount').innerText;

      const message = `ðŸ“¦ *PasaBuy Order Confirmation*\n\nðŸ§¾ *Confirmation #:* ${confirmationNumber}\nðŸ‘¤ *Name:* ${name}\nðŸ“± *Phone:* ${phone}\nðŸª *Store:* ${store}\nðŸ“… *Delivery:* ${deliveryType} - ${deliveryDate} ${deliveryTime}\n\nðŸ›ï¸ *Items:*\n${summary}\nðŸšš *Delivery Fee:* â‚±29.99\nðŸ’¼ *Service Fee:* â‚±10.01\nðŸ’° *Total:* ${total}`;

      const whatsappURL = `https://wa.me/63XXXXXXXXXX?text=${encodeURIComponent(message)}`;
      window.open(whatsappURL, '_blank');
    }

    // Add first item by default
    window.onload = () => {
      addItem();
      handleDeliveryType('Today');
    }

    // Live update on any form change
    document.querySelectorAll('input, select').forEach(el => {
      el.addEventListener('input', updateCartSummary);
    });
  </script>
</body>
</html>
