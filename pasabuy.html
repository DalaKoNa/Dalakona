<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dala Na â€“ PasaBuy Order</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: #fff;
      max-width: 600px;
      margin: auto;
    }
    h2 {
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      margin-bottom: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .item-group {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 12px;
      margin-bottom: 10px;
      position: relative;
    }
    .item-group input {
      margin-bottom: 8px;
    }
    .remove-item-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      background: #ffdddd;
      border: none;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 8px;
    }
    #summary-box {
      background: #f9f9f9;
      padding: 12px;
      border-radius: 8px;
    }
    .proof-upload {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ğŸšš PasaBuy Order Form</h2>

  <label>Store Name *</label>
  <select id="store" required>
    <option value="">-- Select Store --</option>
    <option>Handumanan Hypermarket</option>
    <option>Chooks To Go</option>
    <option>Uling Rooster</option>
    <option>Goldilocks</option>
    <option>The Generics Pharmacy</option>
    <option>Watsons</option>
    <option>Julie's Bakeshop</option>
    <option>Bong Bongs</option>
    <option>Don Macchiatos</option>
    <option>Joe Joe's Chicken</option>
    <option>JDE Hardware and Supply</option>
    <option>Sabon Depot</option>
    <option>Mr DIY</option>
    <option>Others (Specify)</option>
  </select>

  <div id="items-container"></div>
  <button type="button" onclick="addItem()">+ Add Another Item</button>

  <label>Estimated Budget (PHP) *</label>
  <input type="number" id="budget" required />

  <label>Exact Address *</label>
  <input type="text" id="address" required />

  <label>Geo Location (Detected) *</label>
  <input type="text" id="geo" readonly required />

  <label>Delivery Time *</label>
  <select id="deliveryTime" required>
    <option value="Today">Today (within 1 hour)</option>
    <option value="Later">Deliver Later (specify below)</option>
  </select>

  <input type="datetime-local" id="laterTime" style="display:none" />

  <label>Service Fee: <strong>PHP 29.99</strong></label>
  <label>Delivery Fee: <strong>PHP 10.01</strong></label>

  <label>50% Down-Payment Bank Info:</label>
  <div id="summary-box">
    GCash: 0912-345-6789 <br />
    PayMaya: 0912-345-6789
  </div>

  <label>Upload Proof of Deposit *</label>
  <input type="file" id="proof" accept="image/*" required />

  <label>Name *</label>
  <input type="text" id="name" required />

  <label>Phone Number *</label>
  <input type="tel" id="phone" required />

  <button onclick="submitOrder()">ğŸ“© Submit to WhatsApp</button>

  <script>
    let itemIndex = 0;

    function addItem(name = '', qty = '') {
      const container = document.getElementById('items-container');
      const itemGroup = document.createElement('div');
      itemGroup.className = 'item-group';
      itemGroup.innerHTML = `
        <input type="text" name="itemName[]" placeholder="Item name (e.g. Soy Sauce)" value="${name}" required />
        <input type="number" name="itemQty[]" placeholder="Quantity (e.g. 2)" value="${qty}" min="1" required />
        <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()">ğŸ—‘</button>
      `;
      container.appendChild(itemGroup);
    }

    // Initial item
    addItem();

    document.getElementById('deliveryTime').addEventListener('change', function () {
      const later = document.getElementById('laterTime');
      later.style.display = this.value === 'Later' ? 'block' : 'none';
      later.required = this.value === 'Later';
    });

    // Get geolocation name
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        try {
          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
          const data = await response.json();
          document.getElementById('geo').value = data.display_name;
        } catch (err) {
          document.getElementById('geo').value = 'Unable to fetch location';
        }
      });
    }

    function submitOrder() {
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const store = document.getElementById('store').value;
      const budget = parseFloat(document.getElementById('budget').value || 0);
      const serviceFee = 29.99;
      const deliveryFee = 10.01;
      const total = budget + serviceFee + deliveryFee;
      const downPayment = total * 0.5;
      const geo = document.getElementById('geo').value;
      const deliveryType = document.getElementById('deliveryTime').value;
      const later = document.getElementById('laterTime').value;

      const items = [...document.querySelectorAll('#items-container .item-group')].map(group => {
        const name = group.querySelector('[name="itemName[]"]').value;
        const qty = group.querySelector('[name="itemQty[]"]').value;
        return `- ${name} x${qty}`;
      }).join('%0A');

      const summary = `Hello Admin,%0A%0A*New PasaBuy Order*%0A%0AğŸ¦ Store: ${store}%0AğŸ¬ Items:%0A${items}%0AğŸ’³ Budget: PHP ${budget.toFixed(2)}%0AğŸ“… Delivery: ${deliveryType === 'Later' ? later : 'Today (within 1 hour)'}%0AğŸ“ Address: ${address}%0AğŸŒ Location: ${geo}%0AğŸ’¼ Name: ${name}%0AğŸ“ Phone: ${phone}%0AğŸ’µ Total: PHP ${total.toFixed(2)}%0AğŸ’¸ 50% Down-Payment: PHP ${downPayment.toFixed(2)}%0A%0APlease check proof of payment attached.`;

      window.open(`https://wa.me/63XXXXXXXXXX?text=${summary}`, '_blank');
    }
  </script>
</body>
</html>
