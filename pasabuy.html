<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PasaBuy ðŸ›’</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 500px;
      padding: 20px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
    }
    h2 {
      text-align: center;
      margin-bottom: 1em;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    .item-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .item-group input {
      flex: 1;
    }
    .item-group button {
      background: #ff4d4f;
      color: white;
      font-size: 18px;
      border: none;
      padding: 0 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    #cart-summary {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .center-button {
      text-align: center;
    }
    .center-button button {
      width: auto;
      background: #28a745;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>PasaBuy Order</h2>
    <form id="pasabuyForm">
      <label for="customerName">Your Name *</label>
      <input type="text" id="customerName" required />

      <label for="customerPhone">Phone Number *</label>
      <input type="tel" id="customerPhone" required />

      <label for="address">Delivery Address *</label>
      <input type="text" id="address" required />

      <label for="location">Exact Location</label>
      <input type="text" id="location" readonly />

      <label>Store *</label>
      <select id="store" required>
        <option value="">--Select Store--</option>
        <option>Handumanan Hypermarket</option>
        <option>Watsons</option>
        <option>Generika</option>
        <option>Mr. DIY</option>
      </select>

      <label>Delivery Type *</label>
      <select id="deliveryType" required onchange="toggleDateTime(this.value)">
        <option value="today">Today (within 1 hour)</option>
        <option value="later">Deliver Later</option>
      </select>

      <label>Date</label>
      <input type="date" id="deliveryDate" disabled required />

      <label>Time</label>
      <input type="time" id="deliveryTime" disabled required />

      <label>Items to Buy *</label>
      <div id="items-container"></div>
      <div class="center-button">
        <button type="button" onclick="addItem()">+ Add Item</button>
      </div>

      <div id="cart-summary">Cart Summary will appear here...</div>

      <div class="center-button">
        <button type="submit" id="submitBtn">Send via WhatsApp</button>
      </div>
    </form>
  </div>

  <script>
    const deliveryDate = document.getElementById('deliveryDate');
    const deliveryTime = document.getElementById('deliveryTime');

    function toggleDateTime(value) {
      const now = new Date();
      if (value === 'today') {
        deliveryDate.valueAsDate = now;
        deliveryTime.value = now.toTimeString().slice(0, 5);
        deliveryDate.disabled = true;
        deliveryTime.disabled = true;
      } else {
        deliveryDate.disabled = false;
        deliveryTime.disabled = false;
        deliveryDate.value = '';
        deliveryTime.value = '';
      }
    }

    function addItem(name = '', qty = '') {
      const container = document.getElementById('items-container');
      const itemGroup = document.createElement('div');
      itemGroup.className = 'item-group';
      itemGroup.innerHTML = `
        <input type="text" name="itemName[]" placeholder="Item name" value="${name}" required />
        <input type="number" name="itemQty[]" placeholder="Qty" value="${qty}" min="1" required />
        <button type="button" onclick="this.parentElement.remove(); updateCartSummary();">&times;</button>
      `;
      container.appendChild(itemGroup);
      updateCartSummary();
    }

    function updateCartSummary() {
      const items = document.querySelectorAll('.item-group');
      let summary = '';
      let subtotal = 0;
      items.forEach((item, i) => {
        const name = item.querySelector('input[name="itemName[]"]').value;
        const qty = item.querySelector('input[name="itemQty[]"]').value;
        summary += `${i + 1}. ${name} x${qty}\n`;
        subtotal += 0; // Placeholder if pricing logic is needed later
      });
      const deliveryFee = 29.99;
      const serviceFee = 10.01;
      const total = deliveryFee + serviceFee + subtotal;
      summary += `\nDelivery Fee: â‚±${deliveryFee.toFixed(2)}\nService Fee: â‚±${serviceFee.toFixed(2)}\nTOTAL: â‚±${total.toFixed(2)}`;
      document.getElementById('cart-summary').textContent = summary;
    }

    document.getElementById('pasabuyForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const name = document.getElementById('customerName').value;
      const phone = document.getElementById('customerPhone').value;
      const address = document.getElementById('address').value;
      const location = document.getElementById('location').value;
      const store = document.getElementById('store').value;
      const type = document.getElementById('deliveryType').value;
      const date = document.getElementById('deliveryDate').value;
      const time = document.getElementById('deliveryTime').value;
      const items = document.querySelectorAll('.item-group');

      let orderItems = '';
      items.forEach((item, i) => {
        const itemName = item.querySelector('input[name="itemName[]"]').value;
        const itemQty = item.querySelector('input[name="itemQty[]"]').value;
        orderItems += `${i + 1}. ${itemName} x${itemQty}\n`;
      });

      const confirmationNumber = Math.floor(100000 + Math.random() * 900000);

      const message = `PasaBuy Order #${confirmationNumber}\n\nName: ${name}\nPhone: ${phone}\nAddress: ${address}\nExact Location: ${location}\nStore: ${store}\nDelivery: ${type === 'today' ? 'Today (within 1 hour)' : `On ${date} at ${time}`}\n\nItems:\n${orderItems}\nDelivery Fee: â‚±29.99\nService Fee: â‚±10.01`;

      const encoded = encodeURIComponent(message);
      window.open(`https://wa.me/63XXXXXXXXXX?text=${encoded}`, '_blank');
    });

    // Auto-geolocation fetch
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
          .then(res => res.json())
          .then(data => {
            document.getElementById('location').value = data.display_name;
          });
      });
    }

    // Default item on load
    addItem();
  </script>
</body>
</html>
