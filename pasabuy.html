<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PasaBuy ‚Äì DalaKoNa</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #0057b8;
      color: white;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .header a {
      color: white;
      text-decoration: none;
    }

    .main-container {
      max-width: 480px;
      margin: 1rem auto;
      padding: 1rem;
    }

    .item-group {
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .remove-btn {
      background: red;
      color: white;
      border: none;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      cursor: pointer;
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 0.9rem;
    }

    .qty-btn {
      width: 2.2rem;
      height: 2.2rem;
      font-size: 1.3rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #f0f0f0;
      cursor: pointer;
    }

    .button {
      margin-top: 1rem;
      width: 100%;
      padding: 0.75rem;
      background: green;
      color: white;
      border: none;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
    }

    .cart-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: #0057b8;
      color: white;
      border: none;
      border-radius: 50%;
      width: 3rem;
      height: 3rem;
      font-size: 1.5rem;
      z-index: 1000;
      cursor: pointer;
    }

    .cart-panel {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%;
      max-width: 380px;
      height: 100%;
      background: #fff;
      box-shadow: -2px 0 8px rgba(0,0,0,0.15);
      transition: right 0.3s ease;
      padding: 1rem;
      z-index: 999;
      overflow-y: auto;
    }

    .cart-panel.open {
      right: 0;
    }

    .footer {
      text-align: center;
      font-size: 0.9rem;
      color: #999;
      margin: 2rem auto;
    }
  </style>
</head>
<body>

<div class="header">
  <a href="index.html">‚Üê Back</a>
  <span>PasaBuy ‚Äì DalaKoNa</span>
  <span style="width: 2rem;"></span>
</div>

<!-- Floating Cart Button -->
<button class="cart-toggle" onclick="toggleCart()">üõí</button>

<!-- Slide-out Cart Panel -->
<div id="cartPanel" class="cart-panel">
  <h2>üßæ Cart Summary</h2>
  <div id="cart-summary"></div>
  <hr/>
  <button class="button" onclick="proceedToCheckout()">Next: Delivery Info</button>
</div>

<!-- Add Items Section -->
<div class="main-container" id="add-items">
  <h2>üõç What do you want us to buy?</h2>
  <div id="items-container"></div>
  <button class="button" style="background:#444;" onclick="addItem()">‚ûï Add Another Item</button>
</div>
<script>
let itemIndex = 0;
const deliveryFee = 29.99;
const serviceFee = 10.01;
let cart = [];

function addItem() {
  const container = document.getElementById("items-container");

  const itemId = `item-${itemIndex}`;
  const wrapper = document.createElement("div");
  wrapper.className = "item-group";
  wrapper.id = itemId;

  wrapper.innerHTML = `
    <label>Item Name:</label>
    <input type="text" class="item-name" placeholder="e.g. 2 Loaf Bread" required />

    <label>Quantity:</label>
    <div style="display:flex; gap: 0.5rem; align-items:center;">
      <button type="button" class="qty-btn" onclick="adjustQty(${itemIndex}, -1)">‚àí</button>
      <input type="number" class="item-qty" id="qty-${itemIndex}" value="1" min="1" style="text-align:center; flex:1;" />
      <button type="button" class="qty-btn" onclick="adjustQty(${itemIndex}, 1)">+</button>
    </div>

    <label>Optional Product Link:</label>
    <input type="url" class="item-link" placeholder="https://..." />

    <label>Optional Photo:</label>
    <input type="file" accept="image/*" class="item-photo" onchange="previewImage(event, ${itemIndex})" />
    <img id="preview-${itemIndex}" style="display:none; max-width:100%; margin-top:0.5rem; border-radius:8px;" />

    <button type="button" class="remove-btn" onclick="removeItem(${itemIndex})">‚úñ Remove</button>
  `;

  container.appendChild(wrapper);
  itemIndex++;
  updateCartSummary();
}

function adjustQty(index, change) {
  const qtyInput = document.getElementById(`qty-${index}`);
  let current = parseInt(qtyInput.value || "1");
  current += change;
  if (current < 1) current = 1;
  qtyInput.value = current;
  updateCartSummary();
}

function removeItem(index) {
  const item = document.getElementById(`item-${index}`);
  if (item) item.remove();
  updateCartSummary();
}

function previewImage(event, index) {
  const file = event.target.files[0];
  const preview = document.getElementById(`preview-${index}`);
  if (file) {
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  }
}

function updateCartSummary() {
  const summaryDiv = document.getElementById("cart-summary");
  const itemGroups = document.querySelectorAll(".item-group");
  cart = [];

  summaryDiv.innerHTML = "";

  itemGroups.forEach((group, i) => {
    const name = group.querySelector(".item-name").value.trim();
    const qty = group.querySelector(".item-qty").value;
    if (name && qty) {
      cart.push({ name, qty });
      const div = document.createElement("div");
      div.textContent = `‚Ä¢ ${qty} √ó ${name}`;
      summaryDiv.appendChild(div);
    }
  });

  if (cart.length > 0) {
    const fees = document.createElement("div");
    fees.innerHTML = `
      <br/>
      üöö Delivery Fee: ‚Ç±${deliveryFee.toFixed(2)}<br/>
      ‚öôÔ∏è Service Fee: ‚Ç±${serviceFee.toFixed(2)}<br/>
      üí∞ Total Add-on: ‚Ç±${(deliveryFee + serviceFee).toFixed(2)}
    `;
    summaryDiv.appendChild(fees);
  } else {
    summaryDiv.textContent = "üõí Your cart is empty.";
  }
}

function toggleCart() {
  const cartPanel = document.getElementById("cartPanel");
  cartPanel.classList.toggle("open");
}

function proceedToCheckout() {
  if (cart.length === 0) {
    alert("Please add at least one item.");
    return;
  }
  toggleCart();
  showCustomerModal();
}
</script>
<!-- Customer Info Modal -->
<div id="customerModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000000aa; z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:2rem; border-radius:16px; width:90%; max-width:480px;">
    <h3>üì¶ Delivery Info</h3>

    <label>Full Name:</label>
    <input type="text" id="cust-name" placeholder="Juan Dela Cruz" required style="width:100%; margin-bottom:0.5rem;"/>

    <label>Phone Number:</label>
    <input type="text" id="cust-phone" placeholder="09XXXXXXXXX" required style="width:100%; margin-bottom:0.5rem;"/>

    <label>Complete Address:</label>
    <input type="text" id="cust-address" placeholder="House No, Street, Barangay, City" required style="width:100%; margin-bottom:0.5rem;"/>

    <label>Payment Method:</label>
    <select id="cust-payment" style="width:100%; margin-bottom:0.5rem;">
      <option value="Cash on Delivery">Cash on Delivery</option>
      <option value="GCash">GCash</option>
      <option value="PayMaya">PayMaya</option>
    </select>

    <div style="text-align:right; margin-top:1rem;">
      <button onclick="submitOrder()" style="padding:0.5rem 1rem; background:green; color:white; border:none; border-radius:8px;">‚úÖ Submit Order</button>
      <button onclick="closeCustomerModal()" style="padding:0.5rem 1rem; background:#ccc; border:none; border-radius:8px;">Cancel</button>
    </div>
  </div>
</div>

<script>
function showCustomerModal() {
  document.getElementById("customerModal").style.display = "flex";
}
function closeCustomerModal() {
  document.getElementById("customerModal").style.display = "none";
}

function generateConfirmationCode() {
  return Math.floor(100000 + Math.random() * 900000);
}

function submitOrder() {
  const name = document.getElementById("cust-name").value.trim();
  const phone = document.getElementById("cust-phone").value.trim();
  const address = document.getElementById("cust-address").value.trim();
  const payment = document.getElementById("cust-payment").value;

  if (!name || !phone || !address) {
    alert("Please fill in all required delivery info.");
    return;
  }

  const confirmationCode = generateConfirmationCode();
  const payStatus = payment === "Cash on Delivery" ? "Unpaid - COD" : `Paid via ${payment}`;

  let message = `üõç *PasaBuy Order ‚Äì DalaKoNa*\n\n`;
  cart.forEach((item, i) => {
    message += `üîπ ${item.name} (x${item.qty})\n`;
  });

  message += `\nüìç *Address:* ${address}`;
  message += `\nüë§ *Customer:* ${name}`;
  message += `\nüìû *Phone:* ${phone}`;
  message += `\nüí≥ *Payment:* ${payStatus}`;
  message += `\nüöö Delivery Fee: ‚Ç±${deliveryFee.toFixed(2)}`;
  message += `\n‚öôÔ∏è Service Fee: ‚Ç±${serviceFee.toFixed(2)}`;
  message += `\nüí∞ Total Add-on: ‚Ç±${(deliveryFee + serviceFee).toFixed(2)}`;
  message += `\n\nüîñ Confirmation #: ${confirmationCode}`;

  navigator.geolocation.getCurrentPosition(pos => {
    const mapUrl = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
    message += `\nüåê Location: ${mapUrl}`;
    sendWhatsApp(message, confirmationCode);
  }, () => {
    sendWhatsApp(message, confirmationCode);
  });
}

function sendWhatsApp(msg, code) {
  const encoded = encodeURIComponent(msg);
  const admin = "639082900309";
  const driver = ""; // blank for now

  // Open WhatsApp chats
  window.open(`https://wa.me/${admin}?text=${encoded}`, "_blank");
  if (driver) {
    setTimeout(() => {
      window.open(`https://wa.me/${driver}?text=${encoded}`, "_blank");
    }, 1000);
  }

  // Close modal and redirect
  closeCustomerModal();
  setTimeout(() => {
    window.location.href = `PasaBuy-thank-you.html?ref=${code}`;
  }, 3000);
}
</script>
<!-- Cart Button (Top Right) -->
<div style="position:fixed; top:1rem; right:1rem; z-index:999;">
  <button onclick="toggleCart()" style="background:#0057b8; color:white; border:none; border-radius:50%; width:3rem; height:3rem; font-size:1.2rem;">üõí</button>
  <div id="cart-count" style="position:absolute; top:-5px; right:-5px; background:red; color:white; font-size:0.8rem; padding:2px 6px; border-radius:50%; display:none;">0</div>
</div>

<!-- Slide Cart Panel -->
<div id="cartPanel" style="position:fixed; top:0; right:-100%; width:100%; max-width:400px; height:100%; background:white; box-shadow:-2px 0 8px rgba(0,0,0,0.2); z-index:1001; transition:right 0.3s ease; padding:1rem; display:flex; flex-direction:column;">
  <h3 style="margin-top:0;">üßæ Your Order</h3>
  <div id="cart-items" style="flex:1; overflow-y:auto; margin-bottom:1rem;"></div>

  <div style="border-top:1px solid #ccc; padding-top:1rem;">
    <p>üöö Delivery Fee: ‚Ç±<span id="fee-delivery">0.00</span></p>
    <p>‚öôÔ∏è Service Fee: ‚Ç±<span id="fee-service">0.00</span></p>
    <h4>üí∞ Total: ‚Ç±<span id="fee-total">0.00</span></h4>
    <button onclick="showCustomerModal()" style="background:green; color:white; width:100%; padding:0.75rem; border:none; border-radius:10px; font-size:1rem; margin-top:0.5rem;">‚úÖ Checkout</button>
    <button onclick="toggleCart()" style="margin-top:0.5rem; width:100%; padding:0.5rem; background:#ccc; border:none; border-radius:10px;">‚ùå Close</button>
  </div>
</div>

<script>
const cartPanel = document.getElementById("cartPanel");
let cart = [];
const deliveryFee = 29.99;
const serviceFee = 10.01;

function toggleCart() {
  const right = cartPanel.style.right === "0px" ? "-100%" : "0px";
  cartPanel.style.right = right;
}

function updateCartDisplay() {
  const container = document.getElementById("cart-items");
  container.innerHTML = "";
  if (cart.length === 0) {
    container.innerHTML = "<p>Your cart is empty.</p>";
  } else {
    cart.forEach((item, i) => {
      const div = document.createElement("div");
      div.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
          <div><strong>${item.name}</strong> x${item.qty}</div>
          <button onclick="removeCartItem(${i})" style="background:red; color:white; border:none; padding:0.25rem 0.5rem; border-radius:6px;">Remove</button>
        </div>
      `;
      container.appendChild(div);
    });
  }

  // Fees
  document.getElementById("fee-delivery").innerText = deliveryFee.toFixed(2);
  document.getElementById("fee-service").innerText = serviceFee.toFixed(2);
  document.getElementById("fee-total").innerText = (deliveryFee + serviceFee).toFixed(2);

  // Cart count
  const cartCount = document.getElementById("cart-count");
  cartCount.innerText = cart.length;
  cartCount.style.display = cart.length > 0 ? "block" : "none";
}

function removeCartItem(index) {
  cart.splice(index, 1);
  updateCartDisplay();
}

function addToCart(itemName, qty = 1) {
  const existing = cart.find(i => i.name === itemName);
  if (existing) {
    existing.qty += qty;
  } else {
    cart.push({ name: itemName, qty });
  }
  updateCartDisplay();
}
</script>
</body>
</html>
