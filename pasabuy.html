<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DalaðŸš²Na â€“ PasaBuy Form</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background: #f7f7f7;
    }
    .form-container {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin: 12px 0 4px;
      font-weight: bold;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .item-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .item-group input[type="text"],
    .item-group input[type="number"] {
      flex: 1;
      min-width: 120px;
    }
    .remove-item-btn {
      background: #e53e3e;
      color: white;
      border: none;
      padding: 0 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn-primary {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>PasaBuy Order Form</h2>
    
    <form id="pasabuyForm">
      <label for="store">Store Name *</label>
      <select id="store" name="store" required>
        <option value="" disabled selected>Select store</option>
        <option>Handumanan Hypermarket</option>
        <option>Chooks to Go</option>
        <option>Uling Rooster</option>
        <option>Goldilocks</option>
        <option>The Generics Pharmacy</option>
        <option>Watsons</option>
        <option>Julie's Bakeshop</option>
        <option>Bong Bongs</option>
        <option>Don Macchiatos</option>
        <option>Joe Joe's Chicken</option>
        <option>JDE Hardware</option>
        <option>Sabon Depot</option>
        <option>Mr DIY</option>
        <option>Others (specify below)</option>
      </select>

      <label>Exact Store or Other Name (if Others)</label>
      <input type="text" name="customStore" placeholder="e.g. Nene Store, Barangay Mart..." />

      <label>Items to Buy *</label>
      <div id="items-container"></div>
      <button type="button" onclick="addItem()">âž• Add Item</button>

      <label for="budget">Estimated Total Budget (â‚±) *</label>
      <select id="budget" name="budget" required onchange="calculateDownPayment()">
        <option value="" disabled selected>Select your budget</option>
        <option value="200">â‚±200</option>
        <option value="300">â‚±300</option>
        <option value="400">â‚±400</option>
        <option value="500">â‚±500</option>
        <option value="750">â‚±750</option>
        <option value="1000">â‚±1,000</option>
        <option value="1500">â‚±1,500</option>
        <option value="2000">â‚±2,000</option>
        <option value="2500">â‚±2,500</option>
        <option value="3000">â‚±3,000</option>
      </select>

      <label for="downPayment">Required Downpayment (50%)</label>
      <input type="text" id="downPayment" readonly placeholder="â‚±0.00" />

      <label>Upload Proof of Deposit *</label>
      <input type="file" name="depositProof" accept="image/*" required />

      <label for="address">Exact Delivery Address *</label>
      <input type="text" name="address" id="address" placeholder="e.g. Purok Y, Handumanan, Bacolod City" required />

      <label for="location">Geo-Location *</label>
      <input type="text" name="location" id="location" placeholder="Fetching your location..." required readonly />

      <label>Delivery Date *</label>
      <input type="date" name="deliveryDate" id="deliveryDate" readonly required />

      <label>Delivery Time *</label>
      <input type="time" name="deliveryTime" id="deliveryTime" readonly required />

      <label for="notes">Special Instructions</label>
      <textarea name="notes" placeholder="Leave at the gate, call when outside, etc."></textarea>

      <button type="submit" class="btn-primary">Submit Order via WhatsApp</button>
    </form>
  </div>

  <script>
    function addItem(name = '', qty = '') {
      const container = document.getElementById('items-container');
      const itemGroup = document.createElement('div');
      itemGroup.className = 'item-group';
      itemGroup.innerHTML = `
        <input type="text" name="itemName[]" placeholder="Item name (e.g. Soy Sauce)" value="${name}" required />
        <input type="number" name="itemQty[]" placeholder="Quantity (e.g. 2)" value="${qty}" min="1" required />
        <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()">ðŸ—‘</button>
      `;
      container.appendChild(itemGroup);
    }

    function calculateDownPayment() {
      const budget = parseFloat(document.getElementById('budget').value || 0);
      const down = (budget * 0.5).toFixed(2);
      document.getElementById('downPayment').value = `â‚±${down}`;
    }

    // Auto-fill delivery date/time
    const today = new Date();
    const isoDate = today.toISOString().split('T')[0];
    const hours = today.getHours().toString().padStart(2, '0');
    const minutes = today.getMinutes().toString().padStart(2, '0');
    document.getElementById('deliveryDate').value = isoDate;
    document.getElementById('deliveryTime').value = `${hours}:${minutes}`;

    // Get geolocation
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${position.coords.latitude}&lon=${position.coords.longitude}&format=json`)
          .then(res => res.json())
          .then(data => {
            document.getElementById('location').value = data.display_name || `${position.coords.latitude}, ${position.coords.longitude}`;
          });
      });
    }

    // WhatsApp Submit Handler
    document.getElementById('pasabuyForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = new FormData(this);
      const items = [...form.getAll('itemName[]')].map((item, i) => `- ${item} x${form.getAll('itemQty[]')[i]}`).join('\n');

      const message = `*New PasaBuy Order*\n\n` +
        `Store: ${form.get('store')}\n` +
        `Items:\n${items}\n\n` +
        `Budget: â‚±${form.get('budget')}\n` +
        `Downpayment: ${document.getElementById('downPayment').value}\n` +
        `Address: ${form.get('address')}\n` +
        `Location: ${form.get('location')}\n` +
        `Delivery: ${form.get('deliveryDate')} at ${form.get('deliveryTime')}\n\n` +
        `Notes: ${form.get('notes') || 'None'}\n`;

      const encoded = encodeURIComponent(message);
      window.open(`https://wa.me/63XXXXXXXXXX?text=${encoded}`, '_blank');
    });
  </script>
</body>
</html>
