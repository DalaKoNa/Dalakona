<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DalaKoNa - PasaBuy </title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }
    .header {
      background-color: #0057b8;
      color: white;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: bold;
    }
    .header a { color: white; text-decoration: none; }
    .container {
      max-width: 500px;
      margin: auto;
      padding: 1rem;
    }
    select, input, textarea, button {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button.primary {
      background-color: #0057b8;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    .modal {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    .footer {
      text-align: center;
      color: #777;
      font-size: 0.875rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="index.html">‚Üê Back</a>
    <span>DalaKoNa - PasaBuy </span>
  </div>
  <div class="container">
    <label for="barangay">Select Barangay</label>
    <select id="barangay">
      <option value="">-- Select your Barangay --</option>
      <option>Handumanan</option>
      <option>Alijis</option>
      <option>Sum-ag</option>
      <option>Banago</option>
      <option>Other</option>
    </select>

    <label for="store">Select Store</label>
    <select id="store">
      <option value="">-- Choose Store --</option>
      <option>MR DIY</option>
      <option>Bong Bongs Bakery</option>
      <option>Julie's Bakeshop</option>
      <option>Don Macchiatos</option>
      <option>Others</option>
    </select>

    <div class="modal">
      <h3>Add Item</h3>
      <input type="text" id="item-name" placeholder="Item name" />
      <input type="number" id="item-qty" placeholder="Quantity" min="1" value="1" />
      <button class="primary" onclick="addItem()">Add Item</button>
    </div>

    <div class="modal">
      <h3>üõí Order Summary</h3>
      <div id="cart-items"></div>
      <div id="total-display"></div>
    </div>

    <div class="modal">
      <h3>Customer Info</h3>
      <input type="text" id="cust-name" placeholder="Full Name" />
      <input type="text" id="cust-phone" placeholder="Phone Number" />
      <input type="email" id="cust-email" placeholder="Email Address (optional)" />

      <label for="cust-location">üìå Location Pin (auto-filled or paste Google Maps link)</label>
      <input type="text" id="cust-location" placeholder="https://maps.google.com/..." />
      <button type="button" onclick="getUserLocation()">üìç Get My Location</button>

      <label>
        <input type="checkbox" id="schedule-toggle" onchange="toggleScheduledField()" />
        üóìÔ∏è Schedule for later?
      </label>
      <div id="scheduled-wrapper" style="display:none;">
        <label for="scheduled-delivery">Scheduled Delivery Date & Time</label>
        <input type="datetime-local" id="scheduled-delivery" />
      </div>

      <input type="text" id="delivery-date" readonly />
      <input type="text" id="delivery-time" readonly />

      <select id="cust-method">
        <option>Cash on Delivery</option>
        <option>GCash</option>
        <option>PayMaya</option>
      </select>

      <label>Notes (optional)</label>
      <textarea id="cust-notes" placeholder="Special Notes (optional)"></textarea>

      <div class="modal">
        <strong>Payment Notes:</strong><br />
        Online payments may incur a small transfer fee. GCash/PayMaya QR will be sent after confirmation.
      </div>

      <button class="primary" onclick="submitOrder()">Submit Order via WhatsApp</button>
    </div>

    <div class="footer">
      üöã DalaKoNa Pasabuy ‚Ä¢ Fast. Local. Trusted.
    </div>
  </div>

  <script>
    const items = [];
    const serviceFee = 10.01;
    const deliveryFee = 29.99;
    const adminNumber = '639082900309';

    function addItem() {
      const name = document.getElementById('item-name').value;
      const qty = parseInt(document.getElementById('item-qty').value);
      if (!name || qty < 1) return alert("Enter valid item and quantity");
      items.push({ name, qty });
      document.getElementById('item-name').value = "";
      document.getElementById('item-qty').value = 1;
      renderCart();
    }

    function renderCart() {
      const container = document.getElementById('cart-items');
      container.innerHTML = items.map(i => `üîπ ${i.name} (x${i.qty})`).join('<br>');
      const subtotal = 0;
      const total = subtotal + serviceFee + deliveryFee;
      document.getElementById('total-display').innerHTML = `
        <br>Subtotal: ‚Ç±${subtotal.toFixed(2)}<br>
        Service Fee: ‚Ç±${serviceFee.toFixed(2)}<br>
        Delivery Fee: ‚Ç±${deliveryFee.toFixed(2)}<br>
        <strong>Total: ‚Ç±${total.toFixed(2)}</strong><br>
        <em>Total may vary based on product availability</em>`;
    }

    function submitOrder() {
      const name = document.getElementById('cust-name').value;
      const phone = document.getElementById('cust-phone').value;
      const email = document.getElementById('cust-email').value;
      const notes = document.getElementById('cust-notes').value;
      const locationPin = document.getElementById("cust-location").value.trim();
      const method = document.getElementById('cust-method').value;
      const date = document.getElementById('delivery-date').value;
      const time = document.getElementById('delivery-time').value;
      const store = document.getElementById('store').value;
      const barangay = document.getElementById('barangay').value;
      const scheduled = document.getElementById('schedule-toggle').checked ? document.getElementById('scheduled-delivery').value : null;

      const confirmation = Math.floor(Math.random() * 900000 + 100000);

      const itemList = items.map(i => `üîπ ${i.name} (x${i.qty})`).join("\n");

      const message = `
üìü New Order - DalaKoNa Pasabuy

Confirmation #: ${confirmation}
Store: ${store}
Name: ${name}
Phone: ${phone}
Email: ${email || 'N/A'}
Barangay: ${barangay}
üìå Location Pin: ${locationPin || 'N/A'}
Notes: ${notes || 'N/A'}

Items:\n${itemList}

Service Fee: ‚Ç±${serviceFee.toFixed(2)}
Delivery Fee: ‚Ç±${deliveryFee.toFixed(2)}
Total: To be confirmed

Delivery: ${scheduled || `${date} ${time}`}
Payment: ${method}`;

      const encoded = encodeURIComponent(message);
      window.open(`https://wa.me/${adminNumber}?text=${encoded}`, '_blank');
      setTimeout(() => {
        window.location.href = 'pasabuy-thank-you.html?ref=' + confirmation;
      }, 2000);
    }

    function getUserLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;
            document.getElementById("cust-location").value = mapLink;
          },
          function (error) {
            alert("Location access denied. Please allow location access or enter manually.");
          }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    function toggleScheduledField() {
      const wrapper = document.getElementById("scheduled-wrapper");
      wrapper.style.display = document.getElementById("schedule-toggle").checked ? "block" : "none";
    }

    window.onload = () => {
      const now = new Date();
      now.setHours(now.getHours() + 1);
      document.getElementById("delivery-date").value = now.toISOString().split("T")[0];
      document.getElementById("delivery-time").value = now.toTimeString().slice(0,5);
    }
  </script>
</body>
</html>
