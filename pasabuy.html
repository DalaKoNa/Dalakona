<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PasaBuy Order Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #f0f0f0;
      margin: 0;
      padding: 2rem;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    .item-group {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .item-group input {
      flex: 1;
    }
    .remove-item-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
    }
    #items-container {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ›’ PasaBuy Order Form</h2>
    <form id="orderForm">

      <label>Customer Name *</label>
      <input type="text" id="customerName" required />

      <label>Phone Number *</label>
      <input type="tel" id="customerPhone" required />

      <label>Email *</label>
      <input type="email" id="customerEmail" required />

      <label>Store *</label>
      <select id="store" required>
        <option value="">-- Select Store --</option>
        <option>Handumanan Hypermarket</option>
        <option>Chooks To Go</option>
        <option>Uling Rooster</option>
        <option>Goldilocks</option>
        <option>The Generics Pharmacy</option>
        <option>Watsons</option>
        <option>Julie's Bakeshop</option>
        <option>Bong Bongs</option>
        <option>Don Macchiatos</option>
        <option>Joe Joe's Chicken</option>
        <option>JDE Hardware and Construction Supply</option>
        <option>Sabon Depot</option>
        <option>Mr. DIY</option>
        <option>Others (Please Specify Below)</option>
      </select>

      <label>If "Others", specify</label>
      <input type="text" id="otherStore" />

      <label>Items to Buy *</label>
      <div id="items-container"></div>
      <button type="button" onclick="addItem()">â• Add Item</button>

      <label>Exact Address *</label>
      <textarea id="address" placeholder="e.g. Purok Masinadyahon, Brgy. Handumanan, Bacolod City" required></textarea>

      <label>Detected Location *</label>
      <input type="text" id="geoLocation" required />

      <label>Delivery Type *</label>
      <select id="deliveryType" required onchange="toggleDeliveryFields()">
        <option value="">-- Select --</option>
        <option value="today">Today (Within 1 hour)</option>
        <option value="later">Deliver Later</option>
      </select>

      <label>Delivery Date *</label>
      <input type="date" id="deliveryDate" required />

      <label>Delivery Time *</label>
      <input type="time" id="deliveryTime" required />

      <label>Budget (â‚±, max 3000) *</label>
      <input type="number" id="budget" max="3000" min="1" required />

      <label>Downpayment Bank Details *</label>
      <input type="text" id="bankDetails" placeholder="e.g. GCash 0917XXXXXXX" required />

      <label>Proof of Deposit *</label>
      <input type="file" id="depositProof" required />

      <br /><br />
      <button type="submit">ğŸ“¤ Submit via WhatsApp</button>
    </form>
  </div>

  <script>
    function addItem(name = '', qty = '') {
      const container = document.getElementById('items-container');
      const itemGroup = document.createElement('div');
      itemGroup.className = 'item-group';
      itemGroup.innerHTML = `
        <input type="text" name="itemName[]" placeholder="Item name" value="${name}" required />
        <input type="number" name="itemQty[]" placeholder="Qty" value="${qty}" min="1" required />
        <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()">ğŸ—‘</button>
      `;
      container.appendChild(itemGroup);
    }

    function toggleDeliveryFields() {
      const type = document.getElementById('deliveryType').value;
      const dateField = document.getElementById('deliveryDate');
      const timeField = document.getElementById('deliveryTime');
      const now = new Date();
      if (type === 'today') {
        const todayStr = now.toISOString().split('T')[0];
        dateField.value = todayStr;
        dateField.readOnly = true;

        let hour = now.getHours() + 1;
        if (hour >= 24) hour = 23;
        timeField.value = `${hour.toString().padStart(2, '0')}:00`;
        timeField.readOnly = true;
      } else {
        dateField.readOnly = false;
        timeField.readOnly = false;
        dateField.value = '';
        timeField.value = '';
      }
    }

    document.getElementById('orderForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const confirmationCode = 'DALA' + Math.floor(100000 + Math.random() * 900000);
      const name = document.getElementById('customerName').value;
      const phone = document.getElementById('customerPhone').value;
      const email = document.getElementById('customerEmail').value;
      const store = document.getElementById('store').value === 'Others (Please Specify Below)'
        ? document.getElementById('otherStore').value
        : document.getElementById('store').value;
      const address = document.getElementById('address').value;
      const geo = document.getElementById('geoLocation').value;
      const type = document.getElementById('deliveryType').value === 'today'
        ? 'Today (within 1 hour)'
        : 'Deliver Later';
      const date = document.getElementById('deliveryDate').value;
      const time = document.getElementById('deliveryTime').value;
      const budget = parseFloat(document.getElementById('budget').value);
      const bank = document.getElementById('bankDetails').value;
      const items = Array.from(document.querySelectorAll('.item-group')).map(group => {
        const name = group.querySelector('input[name="itemName[]"]').value;
        const qty = group.querySelector('input[name="itemQty[]"]').value;
        return `- ${name} Ã—${qty}`;
      }).join('\n');

      const down = (budget * 0.5).toFixed(2);
      const total = budget.toFixed(2);

      const msg = `ğŸ›ï¸ *New PasaBuy Order* - Confirmation #${confirmationCode}` +
        `\n\nğŸ“ *Store*: ${store}` +
        `\nğŸ“¦ *Items to Buy:*\n${items}` +
        `\n\nğŸ  *Exact Address*: ${address}` +
        `\nğŸ“Œ *Detected Location*: ${geo}` +
        `\nğŸ“… *Delivery Type*: ${type}` +
        `\nğŸ“† *Delivery Date*: ${date}` +
        `\nâ° *Delivery Time*: ${time}` +
        `\n\nğŸ’¸ *Budget*: â‚±${total}` +
        `\nğŸ”» *50% Downpayment*: â‚±${down}` +
        `\nğŸ¦ *Bank Payment*: ${bank}` +
        `\nğŸ“ *Proof of Deposit*: Attached` +
        `\n\nğŸ‘¤ *Customer Name*: ${name}` +
        `\nğŸ“ *Phone*: ${phone}` +
        `\nğŸ“§ *Email*: ${email}` +
        `\n\nâœ… *Status*: Waiting for rider`;

      const whatsappUrl = `https://wa.me/63XXXXXXXXXX?text=${encodeURIComponent(msg)}`;

      window.location.href = whatsappUrl;
    });
  </script>
</body>
</html>
