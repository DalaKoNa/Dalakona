<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dalaüö≤na RAD Login</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #fffaf7;
      margin: 0;
      padding: 0;
    }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      text-align: center;
    }
    h2 {
      color: #a0527b;
      margin-bottom: 1.5rem;
    }
    input {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    button {
      background: #a0527b;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    }
    .error {
      color: red;
      font-size: 0.9rem;
      display: none;
      margin-bottom: 1rem;
    }
    .dashboard {
      display: none;
      padding: 2rem;
    }
  </style>
</head>
<body>

<!-- Login Modal -->
<div class="modal-backdrop" id="loginModal">
  <div class="modal">
    <h2>Login to Dalaüö≤na RAD</h2>
    <input type="text" id="loginName" placeholder="Full Name (e.g. admin)" />
    <input type="password" id="loginOtp" placeholder="Enter OTP" />
    <div class="error" id="loginError">Invalid name or OTP</div>
    <button onclick="handleLogin()">Login</button>
  </div>
</div>

<!-- Admin Dashboard -->
<div class="dashboard" id="adminDashboard">
  <h2>üë©‚Äçüíº Admin Overview Dashboard</h2>
  <p>See all staff salary records, attendance, delivery logs.</p>
  <!-- Data entry section (Google Sheets linked) -->
  <form id="adminEntryForm">
    <input type="text" id="entryName" placeholder="Staff Name" required />
    <input type="number" id="entryAttendance" placeholder="Work Days" required />
    <input type="number" id="entryDeliveries" placeholder="No. of Deliveries" required />
    <input type="number" id="entryPayout" placeholder="Total Payout" required />
    <input type="email" id="entryEmail" placeholder="Staff Email" required />
    <button type="submit">üì§ Submit Payout</button>
  </form>
  <div id="entryStatus"></div>
</div>

<!-- Staff Dashboard -->
<div class="dashboard" id="staffDashboard">
  <h2>üìÑ Your Payslip</h2>
  <div id="staffPayslip">Loading your record...</div>
</div>

<script>
  const credentials = {
    admin: "radAdmin2024",
    lynn: "radStaff001",
    mario: "radStaff002",
    jenny: "radStaff003",
    assistant: "radAssistant01"
  };

  const sheetURL = "https://script.google.com/macros/s/AKfycbx_S4xpebcAOgeWyAR5_SLMEynlvlifOWUMLQv18FWWpMq8CnQNvQPWvLmrNXVInm5xkA/exec";

  function handleLogin() {
    const name = document.getElementById("loginName").value.trim().toLowerCase();
    const otp = document.getElementById("loginOtp").value.trim();
    const error = document.getElementById("loginError");

    if (credentials[name] && credentials[name] === otp) {
      document.getElementById("loginModal").style.display = "none";

      if (name === "admin") {
        document.getElementById("adminDashboard").style.display = "block";
      } else {
        document.getElementById("staffDashboard").style.display = "block";
        loadStaffPayslip(name);
      }
    } else {
      error.style.display = "block";
    }
  }

  // Admin Form Submission
  document.getElementById("adminEntryForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = {
      name: document.getElementById("entryName").value.trim(),
      attendance: document.getElementById("entryAttendance").value,
      deliveries: document.getElementById("entryDeliveries").value,
      payout: document.getElementById("entryPayout").value,
      email: document.getElementById("entryEmail").value,
      timestamp: new Date().toISOString()
    };

    const query = new URLSearchParams(data);
    const statusDiv = document.getElementById("entryStatus");

    try {
      const res = await fetch(sheetURL + "?" + query);
      const json = await res.json();
      if (json.result === "success") {
        statusDiv.innerText = "‚úÖ Submitted to Google Sheet";
        document.getElementById("adminEntryForm").reset();
      } else {
        statusDiv.innerText = "‚ùå Submission failed";
      }
    } catch (err) {
      statusDiv.innerText = "‚ö†Ô∏è Network error";
    }
  });

  // Load staff record
  async function loadStaffPayslip(name) {
    try {
      const res = await fetch(sheetURL + `?action=getPayslip&name=${name}`);
      const data = await res.json();
      document.getElementById("staffPayslip").innerHTML = data.html || "No record found.";
    } catch {
      document.getElementById("staffPayslip").innerText = "Error loading record.";
    }
  }
</script>

</body>
</html>
