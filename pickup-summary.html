<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pickup Summary ‚Äì DalaKoNa</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fff9e6;
      margin: 0;
      padding: 2rem 1rem;
      color: #333;
    }
    .container {
      max-width: 680px;
      margin: auto;
      background: white;
      border-radius: 16px;
      padding: 2rem;
      border: 2px solid #008060;
    }
    h1 {
      font-family: 'Cinzel', serif;
      color: #008060;
      text-align: center;
      margin-bottom: 1rem;
    }
    .summary {
      line-height: 1.6;
      font-size: 1rem;
      margin-top: 1.5rem;
    }
    .timer {
      text-align: center;
      font-weight: bold;
      margin: 1.5rem 0;
      font-size: 1.2rem;
    }
    .cancel-btn {
      background: #cc0000;
      color: white;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }
    .disabled {
      pointer-events: none;
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üßæ Pickup Request Summary</h1>
    <div class="summary" id="orderSummary">
      Loading summary...
    </div>
    <div class="timer">
      ‚è±Ô∏è Auto-confirming in <span id="countdown">120</span> seconds...
    </div>
    <button id="cancelBtn" onclick="cancelRequest()">‚ùå Cancel Request</button>
  </div>

  <script>
    let cancel = false;
    let confirmCode = "DALA" + Math.floor(Math.random() * 100000);
    let timer = 120;

    function populateSummary() {
      const from = localStorage.getItem("fromArea") || "-";
      const to = localStorage.getItem("toArea") || "-";
      const pickup = localStorage.getItem("pickup") || "-";
      const pickupAddr = localStorage.getItem("pickupAddr") || "-";
      const deliveryAddr = localStorage.getItem("deliveryAddr") || "-";
      const pickupDate = localStorage.getItem("pickupDate") || "-";
      const item = localStorage.getItem("item") || "-";
      const fee = localStorage.getItem("fee") || "0.00";
      const name = localStorage.getItem("fullName") || "-";
      const contact = localStorage.getItem("contact") || "-";
      const email = localStorage.getItem("email") || "-";

      let estTime = "within 1 hour";
      if (from !== to) estTime = "1 hour 10 minutes";

      const summaryText = `
        üîê Confirmation No.: <strong>${confirmCode}</strong><br/>
        <strong>From:</strong> ${from}<br/>
        <strong>To:</strong> ${to}<br/>
        <strong>Pickup:</strong> ${pickup}<br/>
        <strong>Pickup Address:</strong> ${pickupAddr}<br/>
        <strong>Delivery Address:</strong> ${deliveryAddr}<br/>
        <strong>Pickup Date:</strong> ${pickupDate}<br/>
        <strong>Item:</strong> ${item}<br/>
        <strong>Estimated Fee:</strong> ‚Ç±${fee}<br/>
        <strong>Estimated Delivery:</strong> ${estTime}<br/><br/>
        <strong>Customer:</strong> ${name}<br/>
        <strong>Contact:</strong> ${contact}<br/>
        <strong>Email:</strong> ${email}
      `;

      document.getElementById("orderSummary").innerHTML = summaryText;

      // Store full message for WhatsApp
      window._whatsappMessage = 
        `üßæ DalaKoNa Pickup Request\n` +
        `Confirmation: ${confirmCode}\n\n` +
        `From: ${from}\nTo: ${to}\nPickup: ${pickup}\nPickup Address: ${pickupAddr}\nDelivery Address: ${deliveryAddr}\nPickup Date: ${pickupDate}\nItem: ${item}\n\n` +
        `Estimated Fee: ‚Ç±${fee}\nETA: ${estTime}\n\n` +
        `Customer: ${name}\nContact: ${contact}\nEmail: ${email}`;
    }

    function cancelRequest() {
      cancel = true;
      document.querySelector(".timer").innerHTML = "‚ùå Request cancelled.";
      document.getElementById("cancelBtn").classList.add("disabled");
    }

    function autoConfirm() {
      const interval = setInterval(() => {
        if (cancel) {
          clearInterval(interval);
          return;
        }

        timer--;
        document.getElementById("countdown").innerText = timer;

        if (timer <= 0) {
          clearInterval(interval);
          sendWhatsApp();
        }
      }, 1000);
    }

    function sendWhatsApp() {
      const number = "63XXXXXXXXXX"; // üîÅ Replace with admin or merchant number
      const msg = encodeURIComponent(window._whatsappMessage);
      window.location.href = `https://wa.me/${number}?text=${msg}`;
    }

    populateSummary();
    autoConfirm();
  </script>
</body>
</html>
