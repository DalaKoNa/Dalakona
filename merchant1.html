<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Merchant 1 | Dala🚲na</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <a href="#" class="close-btn" id="closeBtn">&times;</a>
    <a href="index.html">Home</a>
    <a href="https://airtable.com/appISjv70ZQ4pxBxv/pagAPO8f6i7wAMjMw/form" target="_blank">Join as Rider</a>
    <a href="https://airtable.com/appISjv70ZQ4pxBxv/pagI0B2GjHT1q5SvO/form" target="_blank">Join as Merchant</a>
    <a href="index.html#partners">Our Partner Merchants</a>
  </div>

  <!-- Navbar -->
  <header class="navbar">
    <div id="hamburger" class="hamburger">&#9776;</div>
    <a href="index.html" class="title">Dala🚲na.</a>
    <div class="cart">🛒 <span id="cart-count">0</span></div>
  </header>

  <!-- Merchant Content -->
  <section class="merchant-detail">
    <h1>Merchant 1 – Grocery Shop</h1>
    <div class="product-list">
      <div class="product">
        <p>Bananas – ₱20</p>
        <button onclick="addToCart('Bananas', 20)">Add</button>
      </div>
      <div class="product">
        <p>Eggs (Dozen) – ₱60</p>
        <button onclick="addToCart('Eggs', 60)">Add</button>
      </div>
      <div class="product">
        <p>Milk – ₱50</p>
        <button onclick="addToCart('Milk', 50)">Add</button>
      </div>
    </div>
  </section>

  <!-- Cart Section -->
  <section class="cart-section">
    <h3>Cart (<span id="cart-count">0</span> items)</h3>
    <ul id="cart-list"></ul>
    <p>Total: ₱<span id="cart-total">0</span></p>
    <a id="checkout-btn" href="#" class="checkout-btn" target="_blank">Checkout</a>
  </section>

  <!-- Script -->
  <script>
    let cart = [];
    let merchantName = "Merchant 1";

    function addToCart(item, price) {
      cart.push({ item, price });
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const cartList = document.getElementById("cart-list");
      const cartTotal = document.getElementById("cart-total");
      const cartCount = document.querySelectorAll("#cart-count");

      cartList.innerHTML = "";
      let total = 0;
      cart.forEach(entry => {
        const li = document.createElement("li");
        li.textContent = `${entry.item} – ₱${entry.price}`;
        cartList.appendChild(li);
        total += entry.price;
      });

      cartTotal.textContent = total;
      cartCount.forEach(span => span.textContent = cart.length);

      const itemsStr = cart.map(e => e.item).join(", ");
      const airtableURL = `https://airtable.com/appISjv70ZQ4pxBxv/pagNTESTFORM?prefill_Merchant=${encodeURIComponent(merchantName)}&prefill_Items=${encodeURIComponent(itemsStr)}&prefill_Total=${total}`;

      document.getElementById("checkout-btn").href = airtableURL;
    }

    // Sidebar script
    const hamburger = document.getElementById("hamburger");
    const sidebar = document.getElementById("sidebar");
    const closeBtn = document.getElementById("closeBtn");

    hamburger.addEventListener("click", () => {
      sidebar.style.width = "250px";
    });

    closeBtn.addEventListener("click", () => {
      sidebar.style.width = "0";
    });

    const sidebarLinks = sidebar.querySelectorAll("a");
    sidebarLinks.forEach(link => {
      link.addEventListener("click", () => {
        sidebar.style.width = "0";
      });
    });
<script>
let cart = [];
let merchantName = "";

function initCart(merchant) {
  merchantName = merchant;
  updateCartDisplay();
}

function addToCart(item, price) {
  cart.push({ item, price });
  updateCartDisplay();
}

function updateCartDisplay() {
  const cartList = document.getElementById("cart-list");
  const cartTotal = document.getElementById("cart-total");
  const cartCount = document.getElementById("cart-count");

  cartList.innerHTML = "";
  let total = 0;
  cart.forEach(entry => {
    const li = document.createElement("li");
    li.textContent = `${entry.item} – ₱${entry.price}`;
    cartList.appendChild(li);
    total += entry.price;
  });

  cartTotal.textContent = total;
  cartCount.textContent = cart.length;
}

function openForm() {
  document.getElementById("checkout-form").classList.remove("hidden");
}
function closeForm() {
  document.getElementById("checkout-form").classList.add("hidden");
}

document.getElementById("order-form").addEventListener("submit", function(e) {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const contact = document.getElementById("contact").value;
  const address = document.getElementById("address").value;
  const notes = document.getElementById("notes").value;

  const items = cart.map(c => `${c.item} (₱${c.price})`).join(", ");
  const total = cart.reduce((sum, c) => sum + c.price, 0);

  // ✅ Step 1: Airtable submission in new tab
  const airtableURL = `https://airtable.com/appISjv70ZQ4pxBxv/pagOVgcwePh9vMkW3/form?prefill_Name=${encodeURIComponent(name)}&prefill_Email=${encodeURIComponent(email)}&prefill_Contact+Number=${encodeURIComponent(contact)}&prefill_Address=${encodeURIComponent(address)}&prefill_Special+Instructions=${encodeURIComponent(notes)}&prefill_Items=${encodeURIComponent(items)}&prefill_Total+Price=${total}&prefill_Merchant=${encodeURIComponent(merchantName)}`;
  window.open(airtableURL, "_blank");

  // ✅ Step 2: Send confirmation email via Formspree
  const formData = new FormData();
  formData.append("_replyto", email);
  formData.append("message", `Hi ${name},\n\nThanks for your order from ${merchantName}!\n\nItems: ${items}\nTotal: ₱${total}\n\nWe’ll deliver to:\n${address}\n\n- Dala Ko Na 🚲`);

  fetch("https://formspree.io/f/mpwrqvlo", {
    method: "POST",
    body: formData,
    headers: { 'Accept': 'application/json' }
  }).then(response => {
    if (response.ok) {
      alert("✅ Order submitted! 📧 Confirmation sent.");
    } else {
      alert("⚠️ Order saved, but email failed to send.");
    }
  });

  cart = [];
  updateCartDisplay();
  closeForm();
  this.reset();
});
</script>

  </script>
<!-- Checkout Button -->
<button onclick="openForm()">🛒 Checkout</button>

<!-- Checkout Modal -->
<div id="checkout-form" class="checkout-form hidden">
  <form id="order-form">
    <h3>Checkout</h3>
    <label>Name:</label>
    <input type="text" id="name" required />

    <label>Email:</label>
    <input type="email" id="email" required />

    <label>Contact #:</label>
    <input type="tel" id="contact" required />

    <label>Address:</label>
    <textarea id="address" required></textarea>

    <label>Special Instructions:</label>
    <textarea id="notes"></textarea>

    <button type="submit">Submit Order</button>
    <button type="button" onclick="closeForm()">Cancel</button>
  </form>
</div>

</body>
</html>
