<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Merchant 1 | Dalaüö≤na</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Simple modal styling for demo */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
    }
    .modal.show {
      display: flex;
    }
    .checkout-form {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }
  </style>
</head>
<body>

  <!-- Sidebar and Navbar here (unchanged) -->

  <!-- Merchant Content -->
  <section class="merchant-detail">
    <h1>Merchant 1 ‚Äì Grocery Shop</h1>
    <div class="product-list">
      <div class="product">
        <p>Bananas ‚Äì ‚Ç±20</p>
        <button onclick="addToCart('Bananas', 20)">Add</button>
      </div>
      <div class="product">
        <p>Eggs (Dozen) ‚Äì ‚Ç±60</p>
        <button onclick="addToCart('Eggs', 60)">Add</button>
      </div>
      <div class="product">
        <p>Milk ‚Äì ‚Ç±50</p>
        <button onclick="addToCart('Milk', 50)">Add</button>
      </div>
    </div>
  </section>

  <!-- Cart Section -->
  <section class="cart-section">
    <h3>Cart (<span id="cart-count">0</span> items)</h3>
    <ul id="cart-list"></ul>
    <p>Total: ‚Ç±<span id="cart-total">0</span></p>
    <button id="checkout-btn" onclick="openModal()">üõç Proceed to Checkout</button>
  </section>

  <!-- Modal Checkout Form -->
  <div id="checkoutModal" class="modal">
    <form id="order-form" class="checkout-form">
      <h2>Complete Your Order</h2>

      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" required />

      <label for="email">Email</label>
      <input type="email" id="email" name="email" required />

      <label for="address">Delivery Address</label>
      <textarea id="address" name="address" rows="3" required></textarea>

      <input type="hidden" name="merchant" id="merchant-field" />
      <input type="hidden" name="items" id="items-field" />
      <input type="hidden" name="total" id="total-field" />
      <input type="hidden" name="message" id="message-field" />

      <button type="submit">Submit Order</button>
      <button type="button" onclick="closeModal()">Cancel</button>
    </form>
  </div>

<script>
  // Single source of truth for cart
  let cart = [];
  const merchantName = "Merchant 1";

  function addToCart(item, price) {
    cart.push({ item, price });
    updateCartDisplay();
  }

  function updateCartDisplay() {
    const cartList = document.getElementById("cart-list");
    const cartTotal = document.getElementById("cart-total");
    const cartCount = document.getElementById("cart-count");

    cartList.innerHTML = "";
    let total = 0;

    cart.forEach(entry => {
      const li = document.createElement("li");
      li.textContent = `${entry.item} ‚Äì ‚Ç±${entry.price}`;
      cartList.appendChild(li);
      total += entry.price;
    });

    cartTotal.textContent = total;
    cartCount.textContent = cart.length;

    // Update hidden form fields
    document.getElementById("merchant-field").value = merchantName;
    document.getElementById("items").value = cart.map(e => e.item).join(", ");
    document.getElementById("items-field").value = cart.map(e => e.item).join(", ");
    document.getElementById("total-field").value = total;
  }

  function openModal() {
    if (cart.length === 0) {
      alert("Your cart is empty!");
      return;
    }
    document.getElementById("checkoutModal").classList.add("show");
  }

  function closeModal() {
    document.getElementById("checkoutModal").classList.remove("show");
  }

  document.getElementById("order-form").addEventListener("submit", function(e) {
    e.preventDefault();

    const form = e.target;
    const name = form.name.value.trim();
    const email = form.email.value.trim();
    const address = form.address.value.trim();
    const merchant = merchantName;
    const items = cart.map(c => `${c.item} (‚Ç±${c.price})`).join(", ");
    const total = cart.reduce((sum, c) => sum + c.price, 0);

    // Compose confirmation message
    const message = `Hi ${name},\n\nThanks for your order from ${merchant}!\n\nüßæ Items: ${items}\nüí∞ Total: ‚Ç±${total}\nüìç Delivery Address:\n${address}\n\n‚è∞ ETA: Within 30‚Äì45 mins (subject to availability)\n\nFor urgent questions, reply to this email.\n\n- Dala Ko Na üö≤`;

    // Set message field
    document.getElementById("message-field").value = message;

    const formData = new FormData(form);

    fetch("https://formspree.io/f/mpwrqvlo", {
      method: "POST",
      body: formData,
      headers: { Accept: "application/json" }
    })
    .then(response => {
      if (response.ok) {
        alert("‚úÖ Order submitted! Please check your email.");
        form.reset();
        cart = [];
        updateCartDisplay();
        closeModal();
      } else {
        alert("‚ö†Ô∏è There was a problem submitting your order. Please try again.");
      }
    })
    .catch(() => {
      alert("‚ö†Ô∏è Something went wrong. Try again later.");
    });
  });
</script>

</body>
</html>
