<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Dala-Cart</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header class="navbar">
    <div class="title" onclick="window.location.href='index.html'">DalaðŸš²na.</div>
    <div class="cart">Your Cart ðŸ›’</div>
  </header>

  <section class="cart-page">
    <h1>Review Your Cart</h1>
    
    <ul id="cart-list"></ul>
    <p id="total-price"></p>

    <div class="checkout-info">
      <input type="text" id="user-name" placeholder="Your Name" required />
      <input type="email" id="user-email" placeholder="Email Address" required />
      <input type="tel" id="user-contact" placeholder="Contact Number" required />
    </div>

    <button onclick="submitCart()">Submit Order</button>
  </section>

  <style>
    .checkout-info input {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      font-size: 1em;
    }
  </style>

  <script>
    const cartList = document.getElementById("cart-list");
    const totalPriceDisplay = document.getElementById("total-price");
    let cart = JSON.parse(localStorage.getItem("dalaCart") || "[]");

    if (cart.length === 0) {
      cartList.innerHTML = "<p>Your cart is empty!</p>";
    } else {
      let total = 0;
      cart.forEach((item, i) => {
        const li = document.createElement("li");
        li.textContent = `${item.itemName} from ${item.merchant} â€“ â‚±${item.price}`;
        cartList.appendChild(li);
        total += item.price;
      });
      totalPriceDisplay.textContent = `Total: â‚±${total}`;
    }

    function submitCart() {
      // Get user input
      const name = encodeURIComponent(document.getElementById("user-name").value);
      const email = encodeURIComponent(document.getElementById("user-email").value);
      const contact = encodeURIComponent(document.getElementById("user-contact").value);

      if (!name || !email || !contact) {
        alert("Please fill out all fields.");
        return;
      }

      if (cart.length === 0) {
        alert("Cart is empty!");
        return;
      }

      // Group items by merchant
      const grouped = {};
      let total = 0;

      cart.forEach(item => {
        if (!grouped[item.merchant]) grouped[item.merchant] = [];
        grouped[item.merchant].push(`${item.itemName} (â‚±${item.price})`);
        total += item.price;
      });

      const merchant = Object.keys(grouped)[0]; // For now, handle only 1 merchant
      const items = grouped[merchant].join(", ");

      const filloutURL = "https://forms.fillout.com/t/oMZACWUnvFus";
      const fullURL = `${filloutURL}` +
        `?Name=${name}` +
        `&Email=${email}` +
        `&Contact_Number=${contact}` +
        `&Items_ordered=${encodeURIComponent(items)}` +
        `&Total_price=${encodeURIComponent(total)}`;

      window.location.href = fullURL;
    }
  </script>

</body>
</html>
