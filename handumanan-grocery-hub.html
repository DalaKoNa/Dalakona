<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dalaüö≤Na Handumanan Grocery Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="style.css" />
  <script defer src="/js/handumanan-products.js"></script>
</head>
<body>
  <header>
    <a href="select-store.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
    <h1>Handumanan Grocery Hub</h1>
    <div class="cart-btn" onclick="toggleCart()">
      <i class="fas fa-receipt"></i>
      <span class="cart-count" id="cart-count">0</span>
    </div>
  </header>

  <div class="search-bar">
    <input type="text" id="searchInput" oninput="filterProducts()" placeholder="Search groceries...">
  </div>

  <div class="grid" id="product-list"></div>

  <div class="cart-modal hidden" id="cart-modal">
    <div class="close-btn" onclick="toggleCart()">&times;</div>
    <div class="cart-summary" id="cart-summary"></div>
    <div class="form-section">
      <h3>Customer Info</h3>
      <input type="text" id="customer-name" placeholder="Full Name" required>
      <input type="tel" id="customer-phone" placeholder="Phone Number" required>
      <input type="email" id="customer-email" placeholder="Email Address" required>
      <input type="text" id="delivery-address" placeholder="üìç Paste Google Maps link or address" required>
      <button type="button" class="location-btn" onclick="getLocation()">üìç Use Current Location</button>
      <input type="text" id="delivery-notes" placeholder="üè† House number, landmarks, etc. (Optional)">
      <input type="text" id="payment-ref" placeholder="üìÑ Payment reference number (required for GCash/Bank)" style="margin-top: 0.5rem;" />

      <h3>Delivery Details</h3>
      <input type="date" id="delivery-date" disabled>
      <input type="time" id="delivery-time" disabled>
      <div id="delivery-note" style="font-size: 0.85rem; color: #444;">
        ‚úÖ Allow 1 hour for merchant confirmation and delivery. Time is auto-set.
      </div>

      <h3>Payment</h3>
      <select id="payment-method">
        <option value="GCash">GCash</option>
        <option value="PayMaya">PayMaya</option>
        <option value="Bank">Bank Transfer</option>
        <option value="Cash">Cash on Delivery (COD)</option>
      </select>

      <div style="margin-top: 0.5rem;">
        <a id="payment-link" href="payment-instructions.html?method=GCash" target="_blank" style="color: #008060; text-decoration: underline;">
          View payment instructions
        </a>
      </div>

      <div style="margin-top: 1rem; font-size: 0.85rem; color: #444;">
        ‚úÖ I agree to the
        <a href="terms.html" target="_blank" style="color: #008060; text-decoration: underline;">
          Terms & Conditions
        </a>. Orders are final and subject to store policies.
      </div>

      <button class="checkout-btn bg-gray-400 text-white px-4 py-2 rounded cursor-not-allowed" id="checkout-btn" onclick="submitOrder()" disabled>
        üõí Checkout via WhatsApp
      </button>
    </div>
  </div>

  <script>
    const cart = {};

    function toggleCart() {
      document.getElementById('cart-modal').classList.toggle('hidden');
    }

    function renderProducts() {
      const container = document.getElementById('product-list');
      container.innerHTML = '';
      for (const [category, items] of Object.entries(categorizedProducts)) {
        const categoryBlock = document.createElement('div');
        categoryBlock.innerHTML = `<h3 style="margin-top:1.5rem;margin-bottom:0.5rem;color:#333;">${category}</h3>`;

        items.forEach((item, i) => {
          const index = `${category}-${i}`;
          const card = document.createElement('div');
          card.className = 'card';
          card.dataset.name = item.name.toLowerCase();
          card.innerHTML = `
            <h4>${item.name}</h4>
            <p class="description">${item.description}</p>
            <p><strong>‚Ç±${item.price.toFixed(2)}</strong></p>
            <div class="qty-controls">
              <button onclick="decreaseQty('${index}')">-</button>
              <span id="qty-${index}">0</span>
              <button onclick="increaseQty('${index}', '${category}', ${i})">+</button>
            </div>`;
          categoryBlock.appendChild(card);
        });

        container.appendChild(categoryBlock);
      }
    }

    function increaseQty(index, category, i) {
      const item = categorizedProducts[category][i];
      if (!cart[item.name]) cart[item.name] = { ...item, qty: 0 };
      cart[item.name].qty++;
      updateQty(index);
    }

    function decreaseQty(index) {
      const itemName = document.querySelector(`#qty-${index}`).closest('.card').querySelector('h4').textContent;
      if (cart[itemName]) {
        cart[itemName].qty--;
        if (cart[itemName].qty <= 0) delete cart[itemName];
      }
      updateQty(index);
    }

    function updateQty(index) {
      const itemName = document.querySelector(`#qty-${index}`).closest('.card').querySelector('h4').textContent;
      const qty = cart[itemName]?.qty || 0;
      document.getElementById(`qty-${index}`).innerText = qty;
      document.getElementById('cart-count').innerText = Object.values(cart).reduce((a, b) => a + b.qty, 0);
      updateCartSummary();
    }

    function filterProducts() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      document.querySelectorAll('.card').forEach(card => {
        const name = card.querySelector('h4').textContent.toLowerCase();
        card.style.display = name.includes(input) ? '' : 'none';
      });
    }

    function updateCartSummary() {
      let html = `<h2 style="text-align: center;">üßæ Receipt Summary</h2><ul style="list-style: none; padding: 0;">`;
      let total = 0;
      Object.values(cart).forEach(item => {
        html += `<li><strong>${item.qty}x</strong> ${item.name} <span style="float:right">‚Ç±${(item.qty * item.price).toFixed(2)}</span></li>`;
        total += item.qty * item.price;
      });
      const fee = 29.99;
      const grand = total + fee;
      html += `</ul><hr><p><strong>Subtotal:</strong> <span style="float:right;">‚Ç±${total.toFixed(2)}</span></p>
        <p><strong>Service Fee:</strong> <span style="float:right;">‚Ç±${fee.toFixed(2)}</span></p>
        <hr><h3 style="text-align:center;">Total: ‚Ç±${grand.toFixed(2)}</h3>`;
      document.getElementById('cart-summary').innerHTML = html;
    }

    window.onload = () => {
      renderProducts();
    };
  </script>
</body>
</html>
