<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DalaðŸš²Na Handumanan Grocery Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/ui@latest/dist/tailwind-ui.min.css" />
    <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script defer src="/js/firebase-init.js"></script>
    <script defer src="/js/dala-cart.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-50">
      <a href="select-store.html" class="text-lg font-semibold">â¬… Back</a>
      <h1 class="text-xl font-bold text-green-700">Handumanan Grocery Hub</h1>
      <button id="cartBtn" class="relative">
        ðŸ›’<span id="cart-count" class="ml-1 bg-green-600 text-white rounded-full px-2 text-xs">0</span>
      </button>
    </header>

    <!-- Search -->
    <div class="p-4">
      <input id="searchInput" type="text" placeholder="Search products..." class="w-full border rounded p-2" />
    </div>

    <!-- Product Categories -->
    <div id="productCategories" class="p-4 grid grid-cols-2 gap-2 text-sm font-semibold text-gray-700">
      <button onclick="filterCategory('All')" class="bg-green-100 px-2 py-1 rounded">All</button>
      <button onclick="filterCategory('Canned')" class="bg-green-100 px-2 py-1 rounded">Canned Goods</button>
      <button onclick="filterCategory('Snacks')" class="bg-green-100 px-2 py-1 rounded">Snacks</button>
      <button onclick="filterCategory('Drinks')" class="bg-green-100 px-2 py-1 rounded">Drinks</button>
      <button onclick="filterCategory('Condiments')" class="bg-green-100 px-2 py-1 rounded">Condiments</button>
      <button onclick="filterCategory('Personal Care')" class="bg-green-100 px-2 py-1 rounded">Personal Care</button>
    </div>

    <!-- Product Grid -->
    <div id="productList" class="grid grid-cols-2 sm:grid-cols-3 gap-4 p-4"></div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-end z-50 hidden">
      <div class="bg-white w-full max-w-md h-full p-4 overflow-y-auto relative">
        <button onclick="toggleCart()" class="absolute top-2 right-2 text-gray-600 text-xl">&times;</button>
        <h2 class="text-lg font-bold mb-4">ðŸ§¾ Your DalaðŸš²Na Cart</h2>
        <div id="cart-items"></div>
        <div class="mt-4 border-t pt-2">
          <p id="cart-total" class="text-right font-bold text-lg"></p>
          <p class="text-sm text-gray-500">â‚±3.69 markup applied. No VAT.</p>
        </div>

        <!-- Embedded Fillout Modal -->
        <div class="mt-4">
          <iframe id="fillout-form" src="" width="100%" height="400" frameborder="0" allowtransparency="true" style="border: none; border-radius: 8px; background: transparent;"></iframe>
        </div>

        <!-- Checkout Button -->
        <button id="checkoutBtn" class="w-full bg-green-600 text-white py-2 px-4 mt-4 rounded" onclick="checkout()">âœ… Checkout & Send Order</button>

        <!-- Terms -->
        <p class="text-xs text-gray-500 mt-2">By checking out, you agree to our <a href="#" class="underline">terms & conditions</a>.</p>
      </div>
    </div>

    <script>
      const markup = 3.69;

      const products = [
        { name: 'Sardines in Tomato Sauce', category: 'Canned', price: 17.00 },
        { name: 'Corned Beef 150g', category: 'Canned', price: 39.00 },
        { name: 'Tuna Flakes 180g', category: 'Canned', price: 42.00 },
        { name: 'Nova Chips', category: 'Snacks', price: 27.00 },
        { name: 'Piattos Cheese', category: 'Snacks', price: 26.00 },
        { name: 'Coke 1.5L', category: 'Drinks', price: 67.00 },
        { name: 'Milo 24g', category: 'Drinks', price: 9.00 },
        { name: 'Soy Sauce 200ml', category: 'Condiments', price: 13.00 },
        { name: 'Vinegar 250ml', category: 'Condiments', price: 11.00 },
        { name: 'Shampoo Sachet', category: 'Personal Care', price: 6.00 },
        { name: 'Toothpaste Small', category: 'Personal Care', price: 22.00 }
      ];

      let filteredCategory = 'All';

      function filterCategory(cat) {
        filteredCategory = cat;
        renderProducts();
      }

      function renderProducts() {
        const list = document.getElementById('productList');
        const search = document.getElementById('searchInput').value.toLowerCase();
        list.innerHTML = '';

        const filtered = products.filter(p => {
          const matchCategory = filteredCategory === 'All' || p.category === filteredCategory;
          const matchSearch = p.name.toLowerCase().includes(search);
          return matchCategory && matchSearch;
        });

        filtered.forEach((p, i) => {
          const price = (p.price + markup).toFixed(2);
          list.innerHTML += `
            <div class="bg-white p-3 shadow rounded text-center">
              <p class="font-semibold text-sm">${p.name}</p>
              <p class="text-green-600 font-bold">â‚±${price}</p>
              <button onclick="addToCart(${i})" class="mt-2 bg-green-500 text-white px-2 py-1 rounded text-sm">Add</button>
            </div>
          `;
        });
      }

      document.getElementById('searchInput').addEventListener('input', renderProducts);

      renderProducts();

      // The rest of cart functions, Fillout autofill, WhatsApp message sending, Firebase login detection are inside /js/dala-cart.js
    </script>
  </body>
</html>
