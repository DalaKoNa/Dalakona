<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bakery</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      max-width: 800px;
    }
    .product {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }
    .cart-summary {
      font-size: 0.9rem;
      background: #f9f9f9;
      padding: 10px;
      margin-top: 20px;
    }
    .input-group {
      margin: 10px 0;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
    }
    button {
      padding: 6px 10px;
      margin-left: 5px;
    }
    .actions {
      margin-top: 20px;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 5px 0;
    }
    .qty-buttons button {
      padding: 2px 8px;
      margin-left: 4px;
    }
  </style>
</head>
<body>

  <h1>Bakery</h1>

  <div id="product-list">
    <div class="product"><span>Bread Loaf (‚Ç±80)</span> <button onclick="addToCart('Bread Loaf', 80)">Add to Cart</button></div>
    <div class="product"><span>Ensaymada (‚Ç±45)</span> <button onclick="addToCart('Ensaymada', 45)">Add to Cart</button></div>
    <div class="product"><span>Spanish Bread (‚Ç±40)</span> <button onclick="addToCart('Spanish Bread', 40)">Add to Cart</button></div>
    <div class="product"><span>Pandesal (12 pcs) (‚Ç±60)</span> <button onclick="addToCart('Pandesal (12 pcs)', 60)">Add to Cart</button></div>
    <div class="product"><span>Chocolate Chip Cookies (‚Ç±120)</span> <button onclick="addToCart('Chocolate Chip Cookies', 120)">Add to Cart</button></div>
    <div class="product"><span>Banana Bread (‚Ç±95)</span> <button onclick="addToCart('Banana Bread', 95)">Add to Cart</button></div>
  </div>

  <div class="cart-summary" id="cart-summary">
    <strong>Cart:</strong> Empty<br>
    <strong>Total:</strong> ‚Ç±0
  </div>

  <textarea id="order-summary" rows="10" style="width:100%; margin-top:10px;"></textarea>
  <button onclick="copySummary()">Copy Order Summary</button>

  <div class="input-group">
    <label>Customer Name</label>
    <input type="text" id="customerName" />
  </div>
  <div class="input-group">
    <label>Customer Email</label>
    <input type="email" id="customerEmail" />
  </div>
  <div class="input-group">
    <label>Customer Phone</label>
    <input type="tel" id="customerPhone" />
  </div>
  <div class="input-group">
    <label>WhatsApp Number</label>
    <input type="tel" id="whatsappNumber" />
  </div>
  <div class="input-group">
    <label>Delivery Date</label>
    <input type="date" id="deliveryDate" />
  </div>
  <div class="input-group">
    <label>Delivery Time</label>
    <input type="time" id="deliveryTime" />
  </div>
  <div class="input-group">
    <label>Customization / Special Instructions</label>
    <textarea id="customizationNotes"></textarea>
  </div>

  <div class="actions">
    <button id="checkout-btn">Submit Order</button>
  </div>

  <script>
    const merchantName = "Bakery";
    const merchantNumber = "63XXXXXXXXXX"; // Replace with actual WhatsApp number
    const adminNumber = "63YYYYYYYYYY";    // Replace with admin WhatsApp
    const serviceFee = 29.99;

    let cart = {};

    function addToCart(item, price) {
      if (!cart[item]) {
        cart[item] = { price, qty: 1 };
      } else {
        cart[item].qty++;
      }
      updateCartSummary();
    }

    function adjustQty(item, delta) {
      if (!cart[item]) return;
      cart[item].qty += delta;
      if (cart[item].qty <= 0) delete cart[item];
      updateCartSummary();
    }

    function updateCartSummary() {
      const summaryEl = document.getElementById('cart-summary');
      let html = '';
      let subtotal = 0;

      for (let item in cart) {
        const { qty, price } = cart[item];
        html += `
          <div class="cart-item">
            ${item} √ó ${qty} ‚Äì ‚Ç±${price * qty}
            <span class="qty-buttons">
              <button onclick="adjustQty('${item}', 1)">‚ûï</button>
              <button onclick="adjustQty('${item}', -1)">‚ûñ</button>
            </span>
          </div>
        `;
        subtotal += price * qty;
      }

      const finalTotal = subtotal > 0 ? subtotal + serviceFee : 0;

      summaryEl.innerHTML = `
        <strong>Cart:</strong><br>${html || 'Empty'}<br>
        <strong>Service Fee:</strong> ‚Ç±${subtotal > 0 ? serviceFee.toFixed(2) : '0'}<br>
        <strong>Total:</strong> ‚Ç±${finalTotal.toFixed(2)}
      `;

      const customerName = document.getElementById("customerName").value;
      const customerEmail = document.getElementById("customerEmail").value;
      const customerPhone = document.getElementById("customerPhone").value;
      const deliveryDate = document.getElementById("deliveryDate").value;
      const deliveryTime = document.getElementById("deliveryTime").value;
      const customizationNotes = document.getElementById("customizationNotes").value;

      const summaryText = [
        `Merchant: ${merchantName}`,
        `üôã Name: ${customerName}`,
        `üìß Email: ${customerEmail}`,
        `üì± WhatsApp: ${customerPhone}`,
        ...Object.entries(cart).map(([item, data]) => `${item} √ó ${data.qty} ‚Äì ‚Ç±${data.price * data.qty}`),
        ...(subtotal > 0 ? [`Service & Delivery Fee ‚Äì ‚Ç±${serviceFee.toFixed(2)}`] : []),
        `Total: ‚Ç±${finalTotal.toFixed(2)}`,
        deliveryDate ? `üìÖ Delivery Date: ${deliveryDate}` : '',
        deliveryTime ? `‚è∞ Delivery Time: ${deliveryTime}` : '',
        customizationNotes ? `üìù Special Instructions: ${customizationNotes}` : ''
      ].filter(Boolean).join("\n");

      document.getElementById("order-summary").value = summaryText;
    }

    document.getElementById("deliveryDate").addEventListener("change", () => {
      const deliveryDate = document.getElementById("deliveryDate").value;
      const deliveryTimeInput = document.getElementById("deliveryTime");

      if (!deliveryDate) return;

      const today = new Date();
      const selected = new Date(deliveryDate);

      if (
        today.getFullYear() === selected.getFullYear() &&
        today.getMonth() === selected.getMonth() &&
        today.getDate() === selected.getDate()
      ) {
        const nowPlus80 = new Date(today.getTime() + 80 * 60000);
        const mins = Math.ceil(nowPlus80.getMinutes() / 5) * 5;
        nowPlus80.setMinutes(mins);
        nowPlus80.setSeconds(0);

        const hours = nowPlus80.getHours().toString().padStart(2, '0');
        const minutes = nowPlus80.getMinutes().toString().padStart(2, '0');
        deliveryTimeInput.value = `${hours}:${minutes}`;
      }
    });

    document.getElementById("checkout-btn").onclick = () => {
      const customerName = document.getElementById("customerName").value;
      const customerEmail = document.getElementById("customerEmail").value;
      const customerPhone = document.getElementById("customerPhone").value;
      const whatsappNumber = document.getElementById("whatsappNumber").value;
      const deliveryDate = document.getElementById("deliveryDate").value;
      const deliveryTime = document.getElementById("deliveryTime").value;
      const customizationNotes = document.getElementById("customizationNotes").value;
      const summaryText = document.getElementById("order-summary").value;

      if (!customerName || !customerPhone) {
        alert("‚ùó Please enter your name and WhatsApp number.");
        return;
      }

      const waMerchant = `https://wa.me/${merchantNumber}?text=${encodeURIComponent("Hello! New order from " + merchantName + ":\n" + summaryText)}`;
      const waAdmin = `https://wa.me/${adminNumber}?text=${encodeURIComponent("Admin copy - Order from " + merchantName + ":\n" + summaryText)}`;
      const filloutURL = `https://forms.fillout.com/t/oMZACWUnvFus` +
        `?customerName=${encodeURIComponent(customerName)}` +
        `&customerEmail=${encodeURIComponent(customerEmail)}` +
        `&whatsappNumber=${encodeURIComponent(customerPhone)}` +
        `&deliveryDate=${encodeURIComponent(deliveryDate)}` +
        `&deliveryTime=${encodeURIComponent(deliveryTime)}` +
        `&customizationNotes=${encodeURIComponent(customizationNotes)}` +
        `&cartSummary=${encodeURIComponent(summaryText)}`;

      window.open(filloutURL, '_blank');
      window.open(waMerchant, '_blank');
      window.open(waAdmin, '_blank');
    };

    function copySummary() {
      const textarea = document.getElementById("order-summary");
      textarea.select();
      textarea.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("‚úîÔ∏è Nakopya na ang imo order! I-paste ini sa Fillout Form.");
    }
  </script>
</body>
</html>
