<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ellen's Cakes | DalaðŸš²na</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js"></script>
</head>
<body>
  <div class="container">
    <h1>Ellen's Cakes</h1>
    <!-- Products -->
    <div id="product-list"></div>

    <!-- Cart Summary -->
    <div id="cart-summary">
      <h2>Cart Summary</h2>
      <div id="cart-items"></div>
      <p><strong>Total:</strong> â‚±<span id="cart-total">0.00</span></p>

      <!-- Delivery Info -->
      <input type="text" id="customer-name" placeholder="Your Name" required />
      <input type="text" id="whatsapp-number" placeholder="WhatsApp Number" required />
      <input type="email" id="customer-email" placeholder="Email" required />
      <input type="text" id="customer-phone" placeholder="Phone Number" required />
      <input type="date" id="delivery-date" required />
      <input type="time" id="delivery-time" required />
      <textarea id="customization-notes" placeholder="Custom instructions..."></textarea>

      <button onclick="handleCheckout()">Checkout</button>
    </div>
  </div>

  <script>
    // Sample product list
    const products = [
      { name: "Chocolate Cake", price: 499 },
      { name: "Red Velvet Cake", price: 599 }
    ];

    const cart = [];

    function renderProducts() {
      const list = document.getElementById("product-list");
      products.forEach((product, index) => {
        const div = document.createElement("div");
        div.innerHTML = `${product.name} - â‚±${product.price} <button onclick="addToCart(${index})">Add</button>`;
        list.appendChild(div);
      });
    }

    function addToCart(index) {
      cart.push(products[index]);
      updateCart();
    }

    function updateCart() {
      const items = document.getElementById("cart-items");
      const total = document.getElementById("cart-total");
      items.innerHTML = "";
      let sum = 0;
      cart.forEach(item => {
        items.innerHTML += `<p>${item.name} - â‚±${item.price}</p>`;
        sum += item.price;
      });
      total.textContent = sum.toFixed(2);
    }

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCgv0s0WMMI0OpX7O42bb11VM2pttUF0Eg",
      authDomain: "dalahub-f8268.firebaseapp.com",
      projectId: "dalahub-f8268",
      storageBucket: "dalahub-f8268.appspot.com",
      messagingSenderId: "1043572992249",
      appId: "1:1043572992249:web:90b9b4b41d338dc4e21a28"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function handleCheckout() {
      const user = auth.currentUser;
      if (!user) {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
          .then(result => proceedToOrder(result.user))
          .catch(error => alert("Login failed: " + error.message));
      } else {
        proceedToOrder(user);
      }
    }

    function proceedToOrder(user) {
      const cartSummary = cart.map(p => `${p.name} - â‚±${p.price}`).join("%0A");
      const customerName = document.getElementById("customer-name").value;
      const whatsappNumber = document.getElementById("whatsapp-number").value;
      const customerEmail = document.getElementById("customer-email").value;
      const customerPhone = document.getElementById("customer-phone").value;
      const deliveryDate = document.getElementById("delivery-date").value;
      const deliveryTime = document.getElementById("delivery-time").value;
      const notes = document.getElementById("customization-notes").value;

      const filloutUrl = `https://forms.fillout.com/t/oMZACWUnvFus?customerName=${encodeURIComponent(customerName)}&whatsappNumber=${encodeURIComponent(whatsappNumber)}&cartSummary=${encodeURIComponent(cartSummary)}&customizationNotes=${encodeURIComponent(notes)}&deliveryDate=${encodeURIComponent(deliveryDate)}&deliveryTime=${encodeURIComponent(deliveryTime)}&customerEmail=${encodeURIComponent(customerEmail)}&customerPhone=${encodeURIComponent(customerPhone)}`;

      window.open(filloutUrl, '_blank');
    }

    renderProducts();
  </script>
</body>
</html>
